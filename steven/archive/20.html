<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>.NET Junkie - Nested Master Pages Until Orcas</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout12.css" type="text/css" />
	<!--[if IE]>
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ie.css" type="text/css" />
	<![endif]-->
	<!--[if !IE]>-->
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ff.css" type="text/css" />
	<!--<![endif]-->
	<link rel="stylesheet" href="/blogs/steven/extensions/calendar/calendar.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/mobile.css?changed=20121020a" type="text/css" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/print.css?changed=20110919" type="text/css" media="print" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/blogs/steven/rss.xml" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/blogs/steven/atom.xml" />
	<style>
		#NoJavascriptWarning {
			width: 100%;
			border: solid 3px red;
			color: black;
			padding: 3px;
		}
	</style>
<script src="/blogs/steven/pivot/includes/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
function AqtWsjNJKeRVvKKuaV(){ $('input[@name=post]').attr('disabled', ''); }
function iFvuTKm(s){return yqh(OIuJ(EahnLc(s),s.length*8));} function ACUa(a,b,c,d,x,s,t){return bRcLaT(b ^ c ^ d,a,b,x,s,t);} function bRcLaT(q,a,b,x,s,t){return dPhV(DdPGm(dPhV(dPhV(a,q),dPhV(x,t)),s),b);}function us(a,b,c,d,x,s,t){return bRcLaT((b&c)|((~b)&d),a,b,x,s,t);} function DdPGm(num,cnt){return(num<<cnt)|(num>>>(32-cnt));} function JuITXppQ(){var HUBzgAMw = 4; HUBzgAMw += 0; HUBzgAMw += 1; HUBzgAMw += 2; HUBzgAMw += 3; HUBzgAMw += 4; HUBzgAMw += 5; HUBzgAMw += 6; HUBzgAMw += 7; HUBzgAMw += 8; HUBzgAMw += 9; HUBzgAMw += 10; HUBzgAMw += 11; HUBzgAMw += 12; HUBzgAMw += 13; HUBzgAMw += 14; HUBzgAMw += 15; HUBzgAMw += 16; HUBzgAMw += 17; HUBzgAMw += 18; HUBzgAMw += 19; HUBzgAMw += 20; HUBzgAMw += 21; HUBzgAMw += 22; HUBzgAMw += 23; HUBzgAMw += 24; HUBzgAMw += 25; HUBzgAMw += 26; HUBzgAMw += 27; HUBzgAMw += 28; HUBzgAMw += 29; HUBzgAMw += 30; HUBzgAMw += 31; HUBzgAMw += 32; HUBzgAMw += 33; HUBzgAMw += 34; HUBzgAMw += 35; HUBzgAMw += 36; HUBzgAMw += 37; HUBzgAMw += 38; HUBzgAMw += 39; HUBzgAMw += 40; HUBzgAMw += 41; HUBzgAMw += 42; HUBzgAMw += 43; HUBzgAMw += 44; HUBzgAMw += 45; HUBzgAMw += 46; HUBzgAMw += 47; HUBzgAMw += 48; return HUBzgAMw; }  function EahnLc(vfvw){var mRSBWO=Array();var N=(1<<8)-1;for(var i=0;i<vfvw.length*8;i+=8)mRSBWO[i>>5]|=(vfvw.charCodeAt(i/8)&N)<<(i%32);return mRSBWO;} function OIuJ(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=us(a,b,c,d,x[i+0],7,-680876936);d=us(d,a,b,c,x[i+1],12,-389564586);c=us(c,d,a,b,x[i+2],17,606105819);b=us(b,c,d,a,x[i+3],22,-1044525330);a=us(a,b,c,d,x[i+4],7,-176418897);d=us(d,a,b,c,x[i+5],12,1200080426);c=us(c,d,a,b,x[i+6],17,-1473231341);b=us(b,c,d,a,x[i+7],22,-45705983);a=us(a,b,c,d,x[i+8],7,1770035416);d=us(d,a,b,c,x[i+9],12,-1958414417);c=us(c,d,a,b,x[i+10],17,-42063);b=us(b,c,d,a,x[i+11],22,-1990404162);a=us(a,b,c,d,x[i+12],7,1804603682);d=us(d,a,b,c,x[i+13],12,-40341101);c=us(c,d,a,b,x[i+14],17,-1502002290);b=us(b,c,d,a,x[i+15],22,1236535329);a=KkHWLW(a,b,c,d,x[i+1],5,-165796510);d=KkHWLW(d,a,b,c,x[i+6],9,-1069501632);c=KkHWLW(c,d,a,b,x[i+11],14,643717713);b=KkHWLW(b,c,d,a,x[i+0],20,-373897302);a=KkHWLW(a,b,c,d,x[i+5],5,-701558691);d=KkHWLW(d,a,b,c,x[i+10],9,38016083);c=KkHWLW(c,d,a,b,x[i+15],14,-660478335);b=KkHWLW(b,c,d,a,x[i+4],20,-405537848);a=KkHWLW(a,b,c,d,x[i+9],5,568446438);d=KkHWLW(d,a,b,c,x[i+14],9,-1019803690);c=KkHWLW(c,d,a,b,x[i+3],14,-187363961);b=KkHWLW(b,c,d,a,x[i+8],20,1163531501);a=KkHWLW(a,b,c,d,x[i+13],5,-1444681467);d=KkHWLW(d,a,b,c,x[i+2],9,-51403784);c=KkHWLW(c,d,a,b,x[i+7],14,1735328473);b=KkHWLW(b,c,d,a,x[i+12],20,-1926607734);a=ACUa(a,b,c,d,x[i+5],4,-378558);d=ACUa(d,a,b,c,x[i+8],11,-2022574463);c=ACUa(c,d,a,b,x[i+11],16,1839030562);b=ACUa(b,c,d,a,x[i+14],23,-35309556);a=ACUa(a,b,c,d,x[i+1],4,-1530992060);d=ACUa(d,a,b,c,x[i+4],11,1272893353);c=ACUa(c,d,a,b,x[i+7],16,-155497632);b=ACUa(b,c,d,a,x[i+10],23,-1094730640);a=ACUa(a,b,c,d,x[i+13],4,681279174);d=ACUa(d,a,b,c,x[i+0],11,-358537222);c=ACUa(c,d,a,b,x[i+3],16,-722521979);b=ACUa(b,c,d,a,x[i+6],23,76029189);a=ACUa(a,b,c,d,x[i+9],4,-640364487);d=ACUa(d,a,b,c,x[i+12],11,-421815835);c=ACUa(c,d,a,b,x[i+15],16,530742520);b=ACUa(b,c,d,a,x[i+2],23,-995338651);a=Jqx(a,b,c,d,x[i+0],6,-198630844);d=Jqx(d,a,b,c,x[i+7],10,1126891415);c=Jqx(c,d,a,b,x[i+14],15,-1416354905);b=Jqx(b,c,d,a,x[i+5],21,-57434055);a=Jqx(a,b,c,d,x[i+12],6,1700485571);d=Jqx(d,a,b,c,x[i+3],10,-1894986606);c=Jqx(c,d,a,b,x[i+10],15,-1051523);b=Jqx(b,c,d,a,x[i+1],21,-2054922799);a=Jqx(a,b,c,d,x[i+8],6,1873313359);d=Jqx(d,a,b,c,x[i+15],10,-30611744);c=Jqx(c,d,a,b,x[i+6],15,-1560198380);b=Jqx(b,c,d,a,x[i+13],21,1309151649);a=Jqx(a,b,c,d,x[i+4],6,-145523070);d=Jqx(d,a,b,c,x[i+11],10,-1120210379);c=Jqx(c,d,a,b,x[i+2],15,718787259);b=Jqx(b,c,d,a,x[i+9],21,-343485551);a=dPhV(a,olda);b=dPhV(b,oldb);c=dPhV(c,oldc);d=dPhV(d,oldd);}return Array(a,b,c,d);} function vZDnVixXic(oKBPuHzXQLjq){ CEKJxGKMwT = document.getElementById("AMdANjwoCVK"); if(!CEKJxGKMwT){ return false; } else { CEKJxGKMwT.name = iFvuTKm(oKBPuHzXQLjq); CEKJxGKMwT.value = JuITXppQ(); return true; }} function Jqx(a,b,c,d,x,s,t){return bRcLaT(c ^(b|(~d)),a,b,x,s,t);} function dPhV(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);} function KkHWLW(a,b,c,d,x,s,t){return bRcLaT((b&d)|(c&(~d)),a,b,x,s,t);} function yqh(UQ){var fyAhq="0123456789abcdef";var str="";for(var i=0;i<UQ.length*4;i++){str+=fyAhq.charAt((UQ[i>>2]>>((i%4)*8+4))&0xF)+fyAhq.charAt((UQ[i>>2]>>((i%4)*8))&0xF);}return str;}
$(document).ready(function(){ setTimeout("AqtWsjNJKeRVvKKuaV()", 100); });
// -->
</script>

</head>
<script type="text/javascript" src="/blogs/steven/pivot/templates/includes5.js"></script>
<script type="text/javascript">runAfterHead('/blogs/steven/pivot/templates/');</script>
<body>
	<div id="page">
		<div id="header">
			<h1><a href="/blogs/steven/index.php" title=".NET Junkie">.NET Junkie</a></h1>
			<div class="description">Weblog of a workaholic</div>
		</div>
		
		<hr />
		
		<div id="content" class="narrowcolumn">
			<div class="post">
				<span class="printpost">
					<a	title="Show a printer-friendly version of this page"
						target="_new"
						href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=20&print=true">
						<img alt="Print" src="/blogs/steven/pivot/templates/images/print.gif" />
					</a>
				</span>
				<div class="entry" id="entry">
					<span class="entrydate">11 February 07</span>
					<h3><a href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=20">Nested Master Pages Until Orcas</a></h3>
			
					<h4>This article describes how to inherit your .aspx pages from a custom class, in such a way that you can use nested master pages, without getting that terrible '<em>Design view does not support creating or editing nested master pages. To create or edit nested master pages, use Source view</em>' from the Visual Studio Designer.</h4>
					
					<div id="entry_body">
						<a id="body"></a><p>Just before posting this article on my blog I came across <a rel="external" href="http://weblogs.asp.net/scottgu/archive/2005/11/11/430382.aspx" target="_blank" title="ScottGu's Blog - Tips for Nested Master Pages and VS 2005 Design-Time">an article</a> from <a rel="external" href="http://weblogs.asp.net/scottgu/" target="_blank" title="ScottGu's Blog">Scott Guthrie</a> who describes exactly the same issue with almost exactly the same solution. Even the RuntimeMasterPageFile property has the same name. <a rel="external" href="http://en.wikipedia.org/wiki/D%27oh%21" target="_blank" title="D'oh!">D'oh!</a>.<br /><br />Scott's solution works fine for aspx files, however it doesn't help us with designing master pages. We could try to write a custom class that inherits from the <a rel="external" href="http://msdn2.microsoft.com/en-us/library/system.web.ui.masterpage.aspx" target="_blank" title="MSDN Library - MasterPage Class">MasterPage</a> class in which you can implement the same trick as done in Scott's article with pages. In that case you can't use the PreInit event, because master pages simply don't have a PreInit event. You must choose a different path. Instead you should override the MasterPage's protected SupportAutoEvents property. This property is the first overrideable point within the MasterPage class that is called after the master page has been created by it's owner (Thanks to <a rel="external" href="http://www.aisto.com/roeder/dotnet/" target="_blank" title="Lutz Roeder's .NET Reflector">Reflector</a>). Within this property you can set the master page's MasterPageFile property. The class may look like this:</p><pre class="cs" language="csharp" customtypes="NestedBaseMaster MasterPage">public class NestedBaseMaster : MasterPage<br />{<br />    private bool _addMaster = true;<br />    private string _runtimeMasterPageFile;<br /><br />    public string RuntimeMasterPageFile<br />    {<br />        get { return this._runtimeMasterPageFile; }<br />        set { this._runtimeMasterPageFile = value; }<br />    }<br /><br />    protected override bool SupportAutoEvents<br />    {<br />        get<br />        {<br />            if (this.Page != null &amp;&amp; this._addMaster)<br />            {<br />                if (this.RuntimeMasterPageFile != null)<br />                {<br />                    this.MasterPageFile = <br />                        this.RuntimeMasterPageFile;<br />                }<br />            }<br />            this._addMaster = false;<br /><br />            return base.SupportAutoEvents;<br />        }<br />    }<br />}</pre><p>This however, will lead to nothing. Visual Studio will still show that nasty message and disallows designing your master page. Nested master pages simply can't be edited and there is no work-around for this. For the real solution we must wait until Orcas is released. A lot of exiting features will be added in the Orcas release of Visual Studio and ASP.NET, so I can barely wait.</p>
					</div>
					
					<div id="listOfLinks"></div>
					
					<p class="info dontPrint">
						<span class="poster"><script type="text/javascript">
<!--
	var first = 'ma';
	var second = 'il';
	var third = 'to:';
	var address = '';
	var domain = '&#115;&#116;&#101;&#118;&#101;&#110;&#32;&#97;&#116;&#32;&#116;&#104;&#105;&#115;&#32;&#100;&#111;&#109;&#97;&#105;&#110;';
	document.write('<a href="');
	document.write(first+second+third);
	document.write(address);
	document.write('&#64;');
	document.write(domain);
	document.write('" title="Email Steven">');
	document.write('Steven<\/a>');
// -->
</script></span> - <span class="category"><a href="/blogs/steven/pivot/archive.php?c=ASP.NET">ASP.NET</a>, <a href="/blogs/steven/pivot/archive.php?c=Visual_Studio">Visual Studio</a></span> - 
						<span class="comments"><a href="/blogs/steven/pivot/entry.php?id=20#comm" title="">No comments</a> /  <a href="/blogs/steven/pivot/entry.php?id=20#track" title="">No trackbacks</a></span> - 
						<a href="/blogs/steven/archives/archive_2007-m02.php#e20" title="Permanent link to 'Nested Master Pages Until Orcas' in the archives">&sect;</a> <a href="/blogs/steven/pivot/entry.php?id=20" title="Permanent link to entry 'Nested Master Pages Until Orcas'">&para;</a> 
					</p>
					
					<div id="NoJavascriptWarning">
						The code samples on my weblog are colorized using javascript, but
						you disabled javascript (for my website) on your browser. 
						If you're interested in viewing the posted code snippets in 
						color, please enable javascript.
					</div>
					<script type="text/javascript">
						var noScriptWarning = document.getElementById('NoJavascriptWarning');
						noScriptWarning.style.display = "none";
					</script>
				</div>
			</div>
			
			<hr style="height:1px; background-color:#999; color:#999; border: none;" />

			<p><b>No comments:</b></p>
			<div class="comments">
			<a id="comm"></a>

			</div>

		</div>

		<hr />
		
		<div id="footer">
			<p>&copy; 2007-2019 Steven van Deursen.<br /><span class="dontPrint"><a href="/blogs/steven/rss.xml" title="XML: RSS Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/rssbutton.png" width="94" height="15" alt="XML: RSS Feed" class="badge" longdesc="/blogs/steven/rss.xml" /></a> <a href="/blogs/steven/atom.xml" title="XML: Atom Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/atombutton.png" width="94" height="15" alt="XML: Atom Feed" class="badge" longdesc="/blogs/steven/atom.xml" /></a></span>
			</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/blogs/steven/pivot/templates/CSharpCodeHighlighter0.10.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/MSILCodeHighlighter0.1.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/X86CodeHighlighter0.1.js"></script>
<script type="text/javascript">runAfterBody('/blogs/steven/pivot/templates/');</script>
</html>