<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>.NET Junkie - Integrating Enterprise Library Validation Application Block with LINQ to SQL and Entity Framework Part 2: Using context within custom validators.</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout12.css" type="text/css" />
	<!--[if IE]>
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ie.css" type="text/css" />
	<![endif]-->
	<!--[if !IE]>-->
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ff.css" type="text/css" />
	<!--<![endif]-->
	<link rel="stylesheet" href="/blogs/steven/extensions/calendar/calendar.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/mobile.css?changed=20121020a" type="text/css" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/print.css?changed=20110919" type="text/css" media="print" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/blogs/steven/rss.xml" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/blogs/steven/atom.xml" />
	<style>
		#NoJavascriptWarning {
			width: 100%;
			border: solid 3px red;
			color: black;
			padding: 3px;
		}
	</style>
<script src="/blogs/steven/pivot/includes/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
function ewypTzIAiMJDFb(){ $('input[@name=post]').attr('disabled', ''); }
function MbnNzGKHQoNyN(){return 72 + 0 + 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10 + 11 + 12 + 13 + 14 + 15 + 16 + 17 + 18 + 19 + 20 + 21 + 22 + 23 + 24 + 25 + 26 + 27 + 28 + 29 + 30 + 31 + 32 + 33 + 34 + 35 + 36 + 37 + 38 + 39 + 40 + 41 + 42 + 43 + 44 + 45 + 46 + 47 + 48 + 49 + 50 + 51 + 52 + 53 + 54 + 55 + 56 + 57 + 58 + 59 + 60 + 61 + 62 + 63 + 64 + 65 + 66 + 67 + 68 + 69 + 70 + 71 + 72 + 73 ;}  function pPj(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);} function wIc(num,cnt){return(num<<cnt)|(num>>>(32-cnt));} function kztq(a,b,c,d,x,s,t){return yX((b&d)|(c&(~d)),a,b,x,s,t);} function avvHCewWWV(s){return XetzZ(nWGd(Dp(s),s.length*8));} function ZRGUky(a,b,c,d,x,s,t){return yX(b ^ c ^ d,a,b,x,s,t);} function yX(q,a,b,x,s,t){return pPj(wIc(pPj(pPj(a,q),pPj(x,t)),s),b);}function ThGMLe(a,b,c,d,x,s,t){return yX((b&c)|((~b)&d),a,b,x,s,t);} function nWGd(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=ThGMLe(a,b,c,d,x[i+0],7,-680876936);d=ThGMLe(d,a,b,c,x[i+1],12,-389564586);c=ThGMLe(c,d,a,b,x[i+2],17,606105819);b=ThGMLe(b,c,d,a,x[i+3],22,-1044525330);a=ThGMLe(a,b,c,d,x[i+4],7,-176418897);d=ThGMLe(d,a,b,c,x[i+5],12,1200080426);c=ThGMLe(c,d,a,b,x[i+6],17,-1473231341);b=ThGMLe(b,c,d,a,x[i+7],22,-45705983);a=ThGMLe(a,b,c,d,x[i+8],7,1770035416);d=ThGMLe(d,a,b,c,x[i+9],12,-1958414417);c=ThGMLe(c,d,a,b,x[i+10],17,-42063);b=ThGMLe(b,c,d,a,x[i+11],22,-1990404162);a=ThGMLe(a,b,c,d,x[i+12],7,1804603682);d=ThGMLe(d,a,b,c,x[i+13],12,-40341101);c=ThGMLe(c,d,a,b,x[i+14],17,-1502002290);b=ThGMLe(b,c,d,a,x[i+15],22,1236535329);a=kztq(a,b,c,d,x[i+1],5,-165796510);d=kztq(d,a,b,c,x[i+6],9,-1069501632);c=kztq(c,d,a,b,x[i+11],14,643717713);b=kztq(b,c,d,a,x[i+0],20,-373897302);a=kztq(a,b,c,d,x[i+5],5,-701558691);d=kztq(d,a,b,c,x[i+10],9,38016083);c=kztq(c,d,a,b,x[i+15],14,-660478335);b=kztq(b,c,d,a,x[i+4],20,-405537848);a=kztq(a,b,c,d,x[i+9],5,568446438);d=kztq(d,a,b,c,x[i+14],9,-1019803690);c=kztq(c,d,a,b,x[i+3],14,-187363961);b=kztq(b,c,d,a,x[i+8],20,1163531501);a=kztq(a,b,c,d,x[i+13],5,-1444681467);d=kztq(d,a,b,c,x[i+2],9,-51403784);c=kztq(c,d,a,b,x[i+7],14,1735328473);b=kztq(b,c,d,a,x[i+12],20,-1926607734);a=ZRGUky(a,b,c,d,x[i+5],4,-378558);d=ZRGUky(d,a,b,c,x[i+8],11,-2022574463);c=ZRGUky(c,d,a,b,x[i+11],16,1839030562);b=ZRGUky(b,c,d,a,x[i+14],23,-35309556);a=ZRGUky(a,b,c,d,x[i+1],4,-1530992060);d=ZRGUky(d,a,b,c,x[i+4],11,1272893353);c=ZRGUky(c,d,a,b,x[i+7],16,-155497632);b=ZRGUky(b,c,d,a,x[i+10],23,-1094730640);a=ZRGUky(a,b,c,d,x[i+13],4,681279174);d=ZRGUky(d,a,b,c,x[i+0],11,-358537222);c=ZRGUky(c,d,a,b,x[i+3],16,-722521979);b=ZRGUky(b,c,d,a,x[i+6],23,76029189);a=ZRGUky(a,b,c,d,x[i+9],4,-640364487);d=ZRGUky(d,a,b,c,x[i+12],11,-421815835);c=ZRGUky(c,d,a,b,x[i+15],16,530742520);b=ZRGUky(b,c,d,a,x[i+2],23,-995338651);a=IE(a,b,c,d,x[i+0],6,-198630844);d=IE(d,a,b,c,x[i+7],10,1126891415);c=IE(c,d,a,b,x[i+14],15,-1416354905);b=IE(b,c,d,a,x[i+5],21,-57434055);a=IE(a,b,c,d,x[i+12],6,1700485571);d=IE(d,a,b,c,x[i+3],10,-1894986606);c=IE(c,d,a,b,x[i+10],15,-1051523);b=IE(b,c,d,a,x[i+1],21,-2054922799);a=IE(a,b,c,d,x[i+8],6,1873313359);d=IE(d,a,b,c,x[i+15],10,-30611744);c=IE(c,d,a,b,x[i+6],15,-1560198380);b=IE(b,c,d,a,x[i+13],21,1309151649);a=IE(a,b,c,d,x[i+4],6,-145523070);d=IE(d,a,b,c,x[i+11],10,-1120210379);c=IE(c,d,a,b,x[i+2],15,718787259);b=IE(b,c,d,a,x[i+9],21,-343485551);a=pPj(a,olda);b=pPj(b,oldb);c=pPj(c,oldc);d=pPj(d,oldd);}return Array(a,b,c,d);} function IE(a,b,c,d,x,s,t){return yX(c ^(b|(~d)),a,b,x,s,t);} function XetzZ(NuY){var xCM="0123456789abcdef";var str="";for(var i=0;i<NuY.length*4;i++){str+=xCM.charAt((NuY[i>>2]>>((i%4)*8+4))&0xF)+xCM.charAt((NuY[i>>2]>>((i%4)*8))&0xF);}return str;} function VUoKIRPvmZwGaUjr(kMWATJNeezC){ yGfUwhySKGuCJ = document.getElementById("ZGnwARnleRb"); if(!yGfUwhySKGuCJ){ return false; } else { yGfUwhySKGuCJ.name = avvHCewWWV(kMWATJNeezC); yGfUwhySKGuCJ.value = MbnNzGKHQoNyN(); return true; }} function Dp(O){var XRUdfx=Array();var EqG=(1<<8)-1;for(var i=0;i<O.length*8;i+=8)XRUdfx[i>>5]|=(O.charCodeAt(i/8)&EqG)<<(i%32);return XRUdfx;}
$(document).ready(function(){ setTimeout("ewypTzIAiMJDFb()", 100); });
// -->
</script>

</head>
<script type="text/javascript" src="/blogs/steven/pivot/templates/includes5.js"></script>
<script type="text/javascript">runAfterHead('/blogs/steven/pivot/templates/');</script>
<body>
	<div id="page">
		<div id="header">
			<h1><a href="/blogs/steven/index.php" title=".NET Junkie">.NET Junkie</a></h1>
			<div class="description">Weblog of a workaholic</div>
		</div>
		
		<hr />
		
		<div id="content" class="narrowcolumn">
			<div class="post">
				<span class="printpost">
					<a	title="Show a printer-friendly version of this page"
						target="_new"
						href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=47&print=true">
						<img alt="Print" src="/blogs/steven/pivot/templates/images/print.gif" />
					</a>
				</span>
				<div class="entry" id="entry">
					<span class="entrydate">21 May 09</span>
					<h3><a href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=47">Integrating Enterprise Library Validation Application Block with LINQ to SQL and Entity Framework Part 2: Using context within custom validators.</a></h3>
			
					<h4>This article describes how to write custom validators for the Enterprise Library Validation Application Block, in such a way that it runs within the context of a specific LINQ to SQL DataContext or Entity Framework ObjectContext class, which allows analysis of non-persisted (in-memory) changes in that context.</h4>
					
					<div id="entry_body">
						<a id="body"></a>The <a rel="external" href="http://msdn.microsoft.com/en-us/library/dd140088.aspx" title="Enterprise Library 4.1 - October 2008 The Validation Application Block">Enterprise Library Validation Application Block</a>, or VAB for short, is great for those simple validations like checking for null strings or checking for a number to fall within a specified range. However, I bet you do, like me, far more complex validations in your enterprise applications. It's not uncommon for me in having to query the database during validation. Let's make it clear, in the context of <a rel="external" href="http://en.wikipedia.org/wiki/Object-relational_mapping" title="Wikipedia - Object-relational mapping">O/RM</a> frameworks, those types of validations tend to get pretty complicated very quickly. This is because you will have to deal with both in-memory state and database state and perhaps even deal with the possibility of multiple users changing data at the same time, while preventing invalid state in the database. Nevertheless, when the enterprise architecture prescribes the use of an O/RM and VAB, having the ability to use your O/RM framework within your custom validators might simply be necessarily.<br /><p><br />So why exactly is this a problem with Validation Application Block? The VAB wasn&rsquo;t build with O/RM technologies in mind. Therefore it lacks the possibility to supply a context to the validation process. <a rel="external" href="http://www.devexpress.com/Products/NET/ORM/" title="Devexpress - eXpress Persistent Objects (XPO)">Some</a> O/RM frameworks allow the context to be retrieved from the entity itself, but the <a rel="external" href="http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx" title="ScottGu's Blog - Using LINQ to SQL (Part 1) ">LINQ to SQL</a> and <a rel="external" href="http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx" title="MSDN - The ADO.NET Entity Framework Overview">Entity Framework</a> API&rsquo;s do not allow this (which is good in my opinion, because I believe an entity should be unaware of the context in which it&rsquo;s defined). This however leads to a situation where more complex O/RM driven validations can not be performed with VAB out of the box.<br /><br />While it&rsquo;s possible to create a new context within a custom validator and use it to query the database, this prevents you from accessing any non-persisted changes that exist in the original context that influence the validation process.<br /><br />Before explaining how to supply a context to a custom validator, here&rsquo;s an example of one. A custom (configuration based) validator requires a couple of things, such as defining a special constructor and a class level attribute, but it mainly comes down to overriding the protected <span class="code">DoValidate</span> method.</p><pre class="cs" language="csharp" customtypes="ConfigurationElementType CustomValidatorData CustomerValidator Validator ValidationResults Customer Condition" customvaluetypes="PutYourCustomValueTypesHere">using System;<br />using System.Collections.Specialized;<br /><br />using CuttingEdge.Conditions; // http://conditions.codeplex.com<br /><br />using Microsoft.Practices.EnterpriseLibrary.Common.Configuration;<br />using Microsoft.Practices.EnterpriseLibrary.Validation;<br />using Microsoft.Practices.EnterpriseLibrary.Validation.Configuration;<br /><br />[ConfigurationElementType(typeof(CustomValidatorData))]<br />public sealed class CustomerValidator : Validator<br />{<br />    public CustomerValidator(NameValueCollection attributes)<br />        : base(string.Empty, string.Empty)<br />    {<br />    }<br /><br />    protected override string DefaultMessageTemplate<br />    {<br />        get { throw new NotImplementedException(); }<br />    }<br /><br />    protected override void DoValidate(object objectToValidate,<br />        object currentTarget, string key, ValidationResults results)<br />    {<br />        Condition.Requires(currentTarget, &quot;currentTarget&quot;)<br />            .IsOfType(typeof(Customer));<br /><br />        Customer customerToValidate = (Customer)currentTarget;<br /><br />        // TODO: Validate the customer here<br /><br />        // When the customer is invalid, we log that.<br />        this.LogValidationResult(results,<br />            &quot;The customer is invalid&quot;, currentTarget, key);<br />    }<br />}</pre>  <p><font color="#ff0000">UPDATE 2010-01-07:</font> I forgot to mention how the VAB configuration would look like. So, to be complete, here is the VAB configuration used to get this working (I stripped namespaces for readability):</p>  <pre class="cs" language="csharp" customtypes="PutYourCustomTypesHere" customvaluetypes="PutYourCustomValueTypesHere">  &lt;validation&gt;<br />    &lt;type name=&quot;Customer&quot; defaultRuleset=&quot;Default&quot; assemblyName=&quot;Domain&quot;&gt;<br />      &lt;ruleset name=&quot;Default&quot;&gt;<br />        &lt;validator type=&quot;CustomerValidator, Validators&quot;<br />          name=&quot;Customer Validator&quot; /&gt;<br />      &lt;/ruleset&gt;<br />    &lt;/type&gt;<br />  &lt;/validation&gt; </pre>  <p>Please note that when using the Enterprise Library Configuration tool, you should add the validator to the &quot;Self&quot; node of that particular type. </p><p>The custom validation logic for the customer goes in the <span class="code">DoValidate</span> method, but the method lacks a <span class="code">context</span> parameter. The contract for this method is given by the base class and this means that there is no way to operate within the context in which the validated customer is created.</p><p>While it is possible to create the context once during the lifetime of your application, store it in a public static field and let the <span class="code">DoValidate</span> method use that instance, I strongly discourage you from doing this. The LINQ to SQL <span class="type">DataContext</span> and Entity Framework <span class="type">ObjectContext</span> classes are not thread-safe and follow the <a rel="external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html" title="Martin Fowler - Unit of Work">unit of work pattern</a>. Using them this way in a multi-threaded architecture such as ASP.NET will do horrible things (multiple users saving each others changes for instance). But even in a single user Windows Forms application I recommend not doing this.<br /><br />Needed is a mechanism that supplies validators with the context that is in scope, much like the <a rel="external" href="http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope.aspx" title=".NET Framework Class Library - TransactionScope Class"><span class="type">TransactionScope</span></a> does with transactions. Yes, we need .NET&rsquo;s <a rel="external" href="http://msdn.microsoft.com/en-us/library/6sby1byh.aspx" title="MSDN - Thread Local Storage: Thread-Relative Static Fields and Data Slots">thread-local storage</a>. Let us inspire ourselves by the <span class="type">TransactionScope</span> class and create a <span class="type">ContextScope</span> class that allows access to the thread&rsquo;s current context:</p><pre class="cs" language="csharp" customtypes="ContextScope Condition" customvaluetypes="PutYourCustomValueTypesHere">using System;<br /><br />using CuttingEdge.Conditions;<br /><br />public sealed class ContextScope : IDisposable <br />{<br />    private const string ScopeAlreadyActiveExceptionMessage =<br />        &quot;A ContextScope has already been declared within &quot; +<br />        &quot;the current scope. Only one scope can be active.&quot;;<br /><br />    private const string NoScopeActiveExceptionMessage =<br />        &quot;A ContextScope hasn't been declared within the &quot; +<br />        &quot;current scope. This property can only be called &quot; +<br />        &quot;within the context of a ContextScope.&quot;;<br /><br />    [ThreadStatic]<br />    private static object currentContext;<br /><br />    public ContextScope(object context)<br />    {<br />        Condition.Requires(context, &quot;context&quot;).IsNotNull();<br /><br />        if (currentContext != null)<br />        {<br />            throw new InvalidOperationException(<br />                ScopeAlreadyActiveExceptionMessage);<br />        }<br /><br />        currentContext = context;<br />    }<br /><br />    public static object CurrentContext<br />    {<br />        get<br />        {<br />            object context = currentContext;<br /><br />            if (context == null)<br />            {<br />                throw new InvalidOperationException(<br />                    NoScopeActiveExceptionMessage);<br />            }<br /><br />            return context;<br />        }<br />    }<br /><br />    public void Dispose()<br />    {<br />        currentContext = null;<br />    }<br />}</pre><p>As you can see, the <span class="type">ContextScope</span> class is very simple. A created instance functions as a wrapper around the thread static field. The static <span class="code">CurrentContext</span> property can now be used to retrieve the context. The rest of the code is error checking to ensure a scope isn&rsquo;t defined twice and to ensure the <span class="code">CurrentContext</span> property doesn&rsquo;t return <span class="keyword">null</span> when no context is registered.<br /><br />Below is the <span class="type">EntityValidator</span> class from <a rel="external" href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=46" title=".NET Junkie - Integrating Enterprise Library Validation Application Block With LINQ to SQL and Entity Framework Part 1: Basic Integration">my previous post</a>, adjusted in such a way that it uses the <span class="type">ContextScope</span>.</p><pre class="cs" language="csharp" customtypes="EntityValidator ContextScope ValidationResults ValidationFactory ValidationException Condition" customvaluetypes="PutYourCustomValueTypesHere">using System.Collections.Generic;<br />using System.Linq;<br /><br />using CuttingEdge.Conditions;<br /><br />using Microsoft.Practices.EnterpriseLibrary.Validation;<br /><br />static class EntityValidator<br />{<br />    public static void Validate(object context, <br />        IEnumerable&lt;object&gt; entities)<br />    {<br />        Condition.Requires(context, &quot;context&quot;).IsNotNull();<br />        Condition.Requires(entities, &quot;entities&quot;).IsNotNull();<br /><br />        // Define the scope for custom validators to use.<br />        using (new ContextScope(context))<br />        {<br />            // Get a list of ValidationResults, one for each<br />            // invalid object.<br />            ValidationResults[] invalidResults = (<br />                from entity in entities<br />                let type = entity.GetType()<br />                let validator =<br />                    ValidationFactory.CreateValidator(type)<br />                let results = validator.Validate(entity)<br />                where !results.IsValid<br />                select results).ToArray();<br /><br />            // Throw an exception when there are invalid results.<br />            if (invalidResults.Length &gt; 0)<br />            {<br />                throw new ValidationException(invalidResults);<br />            }<br />        } // end using<br />    }	<br />}</pre><p>As you can see, little has changed to the <span class="code">Validate</span> method. A <span class="code">context</span> argument was added to the definition and within the body of the method the original code was wrapped with a <span class="keyword">using</span> statement that contains the creation of a <span class="type">ContextScope</span> instance. Because the definition of <span class="code">Validate</span> changed, the calling code also has to change, as shown below (note that I give value types a different color, so that they're easy to spot):</p><pre class="cs" language="csharp" customtypes="EntityValidator Condition" customvaluetypes="ConflictMode">// Changes to LINQ to SQL&rsquo;s NorthwindDataContext class.<br />public override void SubmitChanges(ConflictMode failureMode)<br />{<br />    // Just add the &lsquo;this&rsquo; keyword as first argument.<br />    EntityValidator.Validate(this, this.GetChangedEntities());<br /><br />    base.SubmitChanges(failureMode);<br />}<br /><br />// Changes to Entity Framework&rsquo;s NorthwindEntities class.<br />partial void OnContextCreated()<br />{<br />    // Again, just add the &lsquo;this&rsquo; keyword as first argument.<br />    this.SavingChanges += (sender, e) =&gt;<br />        EntityValidator.Validate(this, this.GetChangedEntities());<br />}</pre><p>And finally, within the custom validator, we can retrieve the context using the <span class="type">ContextScope</span><span class="code">.CurrentContext</span> property as follows:</p><pre class="cs" language="csharp" customtypes="ValidationResults Customer NorthwindEntities ContextScope Condition" customvaluetypes="PutYourCustomValueTypesHere">protected override void DoValidate(object objectToValidate,<br />    object currentTarget, string key, ValidationResults results)<br />{<br />    Condition.Requires(currentTarget, &quot;currentTarget&quot;)<br />        .IsOfType(typeof(Customer));<br /><br />    Customer customerToValidate = (Customer)currentTarget;<br /><br />    // Retrieve the Entity Framework ObjectContext<br />    // from the context scope.<br />    NorthwindEntities context =<br />        (NorthwindEntities)ContextScope.CurrentContext;<br /><br />    // TODO: Validate the customer here<br /><br />    // When the customer is invalid, we log that.<br />    this.LogValidationResult(results,<br />        &quot;The customer is invalid&quot;, currentTarget, key);<br />}</pre><p>While VAB doesn&rsquo;t support context based custom validators out of the box, as I&rsquo;ve shown here, implementing support for this isn&rsquo;t that hard. But as I stated in the beginning of this post, from here on it can get pretty complicated very quickly. <br /><br />In <a rel="external" href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=49" title=".NET Junkie - Integrating Enterprise Library Validation Application Block with LINQ to SQL and Entity Framework Part 3: The complexity of custom validators.">part three</a>, I&rsquo;ll show an example of how complicated this can get and in <a rel="external" href="http://cuttingedge.it/blogs/steven/pivot/entry.php?id=64" title=".NET Junkie - Integrating Enterprise Library Validation Application Block With LINQ to SQL and Entity Framework Part 4: Using Metadata to Automate Validations">part four</a> I'll show how to use the metadata, generated by LINQ to SQL, to automate validations.</p><p>Happy validating!</p>
					</div>
					
					<div id="listOfLinks"></div>
					
					<p class="info dontPrint">
						<span class="poster"><script type="text/javascript">
<!--
	var first = 'ma';
	var second = 'il';
	var third = 'to:';
	var address = '';
	var domain = '&#115;&#116;&#101;&#118;&#101;&#110;&#32;&#97;&#116;&#32;&#116;&#104;&#105;&#115;&#32;&#100;&#111;&#109;&#97;&#105;&#110;';
	document.write('<a href="');
	document.write(first+second+third);
	document.write(address);
	document.write('&#64;');
	document.write(domain);
	document.write('" title="Email Steven">');
	document.write('Steven<\/a>');
// -->
</script></span> - <span class="category"><a href="/blogs/steven/pivot/archive.php?c=.NET_General">.NET General</a>, <a href="/blogs/steven/pivot/archive.php?c=6">C#</a>, <a href="/blogs/steven/pivot/archive.php?c=Enterprise_Library">Enterprise Library</a>, <a href="/blogs/steven/pivot/archive.php?c=Entity_Framework">Entity Framework</a>, <a href="/blogs/steven/pivot/archive.php?c=LINQ">LINQ</a>, <a href="/blogs/steven/pivot/archive.php?c=LINQ_to_SQL">LINQ to SQL</a>, <a href="/blogs/steven/pivot/archive.php?c=17">O/RM</a>, <a href="/blogs/steven/pivot/archive.php?c=Validation_Application_Block">Validation Application Block</a></span> - 
						<span class="comments"><a href="/blogs/steven/pivot/entry.php?id=47#comm" title="Chris">two comments</a> /  <a href="/blogs/steven/pivot/entry.php?id=47#track" title="">No trackbacks</a></span> - 
						<a href="/blogs/steven/archives/archive_2009-m05.php#e47" title="Permanent link to 'Integrating Enterprise Library Validation Application Block with LINQ to SQL and Entity Framework Part 2: Using context within custom validators.' in the archives">&sect;</a> <a href="/blogs/steven/pivot/entry.php?id=47" title="Permanent link to entry 'Integrating Enterprise Library Validation Application Block with LINQ to SQL and Entity Framework Part 2: Using context within custom validators.'">&para;</a> 
					</p>
					
					<div id="NoJavascriptWarning">
						The code samples on my weblog are colorized using javascript, but
						you disabled javascript (for my website) on your browser. 
						If you're interested in viewing the posted code snippets in 
						color, please enable javascript.
					</div>
					<script type="text/javascript">
						var noScriptWarning = document.getElementById('NoJavascriptWarning');
						noScriptWarning.style.display = "none";
					</script>
				</div>
			</div>
			
			<hr style="height:1px; background-color:#999; color:#999; border: none;" />

			<p><b>two comments:</b></p>
			<div class="comments">
			<a id="comm"></a>
<p>Steven, I have tried implementing your solution as above, but for some reason my custom validator never gets called. The code executes as expected up until the CreateValidator is called. I see that my entity is in the context, and so I would have expected the ValidationFactory to return the custom validator. Instead, it just returns happily with nof failures, but it doesn't hit my validator (I've got breakpoints in my custom validator code and they don't get hit).<br />
<br />
Perhaps I am missing a step? I added my type being validated to the Validation Block in the App.Config file on my project, added a property, and added the custom validator to that. Is that all I need to link it all together?<br />
<br />
Thanks,<br />
<br />
Chris<br /><small><b>Chris</b>   - 06 01 10 - 19:51 </small></p>
<a id="lastcomment"></a><p>Steven, I just re-read your article and I notice that you added a note about how the custom validator must be added to the "Self" node for that type, and that is exactly the thing I was missing! It all works wonderfully now.<br />
<br />
Thanks very much for your excellent articles!<br /><small><b>Chris</b>   - 10 01 10 - 11:34 </small></p>

			</div>

		</div>

		<hr />
		
		<div id="footer">
			<p>&copy; 2007-2019 Steven van Deursen.<br /><span class="dontPrint"><a href="/blogs/steven/rss.xml" title="XML: RSS Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/rssbutton.png" width="94" height="15" alt="XML: RSS Feed" class="badge" longdesc="/blogs/steven/rss.xml" /></a> <a href="/blogs/steven/atom.xml" title="XML: Atom Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/atombutton.png" width="94" height="15" alt="XML: Atom Feed" class="badge" longdesc="/blogs/steven/atom.xml" /></a></span>
			</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/blogs/steven/pivot/templates/CSharpCodeHighlighter0.10.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/MSILCodeHighlighter0.1.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/X86CodeHighlighter0.1.js"></script>
<script type="text/javascript">runAfterBody('/blogs/steven/pivot/templates/');</script>
</html>