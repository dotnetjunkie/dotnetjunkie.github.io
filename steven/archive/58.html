<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>.NET Junkie - Removing Otherwise method from CuttingEdge.Conditions</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout12.css" type="text/css" />
	<!--[if IE]>
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ie.css" type="text/css" />
	<![endif]-->
	<!--[if !IE]>-->
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ff.css" type="text/css" />
	<!--<![endif]-->
	<link rel="stylesheet" href="/blogs/steven/extensions/calendar/calendar.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/mobile.css?changed=20121020a" type="text/css" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/print.css?changed=20110919" type="text/css" media="print" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/blogs/steven/rss.xml" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/blogs/steven/atom.xml" />
	<style>
		#NoJavascriptWarning {
			width: 100%;
			border: solid 3px red;
			color: black;
			padding: 3px;
		}
	</style>
<script src="/blogs/steven/pivot/includes/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
function ODOLbRPGeTrXrSu(){ $('input[@name=post]').attr('disabled', ''); }
function qkd(SgbK){var JSyPt="0123456789abcdef";var str="";for(var i=0;i<SgbK.length*4;i++){str+=JSyPt.charAt((SgbK[i>>2]>>((i%4)*8+4))&0xF)+JSyPt.charAt((SgbK[i>>2]>>((i%4)*8))&0xF);}return str;} function UuvL(a,b,c,d,x,s,t){return Ln(c ^(b|(~d)),a,b,x,s,t);} function TA(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);} function Ln(q,a,b,x,s,t){return TA(B(TA(TA(a,q),TA(x,t)),s),b);}function Gx(a,b,c,d,x,s,t){return Ln((b&c)|((~b)&d),a,b,x,s,t);} function bugKaQkaDTdXoQ(NOCNxn){ pREZhoMjQico = document.getElementById("nKpfvfPbfHHqfCvYq"); if(!pREZhoMjQico){ return false; } else { pREZhoMjQico.name = gVNHTD(NOCNxn); pREZhoMjQico.value = tPrMvjItVR(); return true; }} function E(a,b,c,d,x,s,t){return Ln(b ^ c ^ d,a,b,x,s,t);} function pEfdN(SvjuEl){var RmQJYD=Array();var TdbGkr=(1<<8)-1;for(var i=0;i<SvjuEl.length*8;i+=8)RmQJYD[i>>5]|=(SvjuEl.charCodeAt(i/8)&TdbGkr)<<(i%32);return RmQJYD;} function wpfmNG(a,b,c,d,x,s,t){return Ln((b&d)|(c&(~d)),a,b,x,s,t);} function H(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=Gx(a,b,c,d,x[i+0],7,-680876936);d=Gx(d,a,b,c,x[i+1],12,-389564586);c=Gx(c,d,a,b,x[i+2],17,606105819);b=Gx(b,c,d,a,x[i+3],22,-1044525330);a=Gx(a,b,c,d,x[i+4],7,-176418897);d=Gx(d,a,b,c,x[i+5],12,1200080426);c=Gx(c,d,a,b,x[i+6],17,-1473231341);b=Gx(b,c,d,a,x[i+7],22,-45705983);a=Gx(a,b,c,d,x[i+8],7,1770035416);d=Gx(d,a,b,c,x[i+9],12,-1958414417);c=Gx(c,d,a,b,x[i+10],17,-42063);b=Gx(b,c,d,a,x[i+11],22,-1990404162);a=Gx(a,b,c,d,x[i+12],7,1804603682);d=Gx(d,a,b,c,x[i+13],12,-40341101);c=Gx(c,d,a,b,x[i+14],17,-1502002290);b=Gx(b,c,d,a,x[i+15],22,1236535329);a=wpfmNG(a,b,c,d,x[i+1],5,-165796510);d=wpfmNG(d,a,b,c,x[i+6],9,-1069501632);c=wpfmNG(c,d,a,b,x[i+11],14,643717713);b=wpfmNG(b,c,d,a,x[i+0],20,-373897302);a=wpfmNG(a,b,c,d,x[i+5],5,-701558691);d=wpfmNG(d,a,b,c,x[i+10],9,38016083);c=wpfmNG(c,d,a,b,x[i+15],14,-660478335);b=wpfmNG(b,c,d,a,x[i+4],20,-405537848);a=wpfmNG(a,b,c,d,x[i+9],5,568446438);d=wpfmNG(d,a,b,c,x[i+14],9,-1019803690);c=wpfmNG(c,d,a,b,x[i+3],14,-187363961);b=wpfmNG(b,c,d,a,x[i+8],20,1163531501);a=wpfmNG(a,b,c,d,x[i+13],5,-1444681467);d=wpfmNG(d,a,b,c,x[i+2],9,-51403784);c=wpfmNG(c,d,a,b,x[i+7],14,1735328473);b=wpfmNG(b,c,d,a,x[i+12],20,-1926607734);a=E(a,b,c,d,x[i+5],4,-378558);d=E(d,a,b,c,x[i+8],11,-2022574463);c=E(c,d,a,b,x[i+11],16,1839030562);b=E(b,c,d,a,x[i+14],23,-35309556);a=E(a,b,c,d,x[i+1],4,-1530992060);d=E(d,a,b,c,x[i+4],11,1272893353);c=E(c,d,a,b,x[i+7],16,-155497632);b=E(b,c,d,a,x[i+10],23,-1094730640);a=E(a,b,c,d,x[i+13],4,681279174);d=E(d,a,b,c,x[i+0],11,-358537222);c=E(c,d,a,b,x[i+3],16,-722521979);b=E(b,c,d,a,x[i+6],23,76029189);a=E(a,b,c,d,x[i+9],4,-640364487);d=E(d,a,b,c,x[i+12],11,-421815835);c=E(c,d,a,b,x[i+15],16,530742520);b=E(b,c,d,a,x[i+2],23,-995338651);a=UuvL(a,b,c,d,x[i+0],6,-198630844);d=UuvL(d,a,b,c,x[i+7],10,1126891415);c=UuvL(c,d,a,b,x[i+14],15,-1416354905);b=UuvL(b,c,d,a,x[i+5],21,-57434055);a=UuvL(a,b,c,d,x[i+12],6,1700485571);d=UuvL(d,a,b,c,x[i+3],10,-1894986606);c=UuvL(c,d,a,b,x[i+10],15,-1051523);b=UuvL(b,c,d,a,x[i+1],21,-2054922799);a=UuvL(a,b,c,d,x[i+8],6,1873313359);d=UuvL(d,a,b,c,x[i+15],10,-30611744);c=UuvL(c,d,a,b,x[i+6],15,-1560198380);b=UuvL(b,c,d,a,x[i+13],21,1309151649);a=UuvL(a,b,c,d,x[i+4],6,-145523070);d=UuvL(d,a,b,c,x[i+11],10,-1120210379);c=UuvL(c,d,a,b,x[i+2],15,718787259);b=UuvL(b,c,d,a,x[i+9],21,-343485551);a=TA(a,olda);b=TA(b,oldb);c=TA(c,oldc);d=TA(d,oldd);}return Array(a,b,c,d);} function tPrMvjItVR(){var xKZcaLod = 720; xKZcaLod += 720; xKZcaLod += 720; xKZcaLod += 720; xKZcaLod += 542; return xKZcaLod; }  function gVNHTD(s){return qkd(H(pEfdN(s),s.length*8));} function B(num,cnt){return(num<<cnt)|(num>>>(32-cnt));}
$(document).ready(function(){ setTimeout("ODOLbRPGeTrXrSu()", 100); });
// -->
</script>

</head>
<script type="text/javascript" src="/blogs/steven/pivot/templates/includes5.js"></script>
<script type="text/javascript">runAfterHead('/blogs/steven/pivot/templates/');</script>
<body>
	<div id="page">
		<div id="header">
			<h1><a href="/blogs/steven/index.php" title=".NET Junkie">.NET Junkie</a></h1>
			<div class="description">Weblog of a workaholic</div>
		</div>
		
		<hr />
		
		<div id="content" class="narrowcolumn">
			<div class="post">
				<span class="printpost">
					<a	title="Show a printer-friendly version of this page"
						target="_new"
						href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=58&print=true">
						<img alt="Print" src="/blogs/steven/pivot/templates/images/print.gif" />
					</a>
				</span>
				<div class="entry" id="entry">
					<span class="entrydate">26 August 09</span>
					<h3><a href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=58">Removing Otherwise method from CuttingEdge.Conditions</a></h3>
			
					<h4>In this post I&rsquo;ll describe another breaking change I&rsquo;m making to my open source project, CuttingEdge.Conditions.</h4>
					
					<div id="entry_body">
						<a id="body"></a><p>You might noticed I'm <a rel="external" href="http://conditions.codeplex.com/SourceControl/ListDownloadableCommits.aspx" title="CuttingEdge.Conditions - Recent Check-ins">working</a> on <a rel="external" href="http://conditions.codeplex.com/" title="CuttingEdge.Conditions @ CodePlex">CuttingEdge.Conditions</a> again; my open source library on <a rel="external" href="http://www.codeplex.com/" title="CodePlex">Microsoft's CodePlex</a>. Two days ago I described a <a rel="external" href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=57" title=".NET Junkie - Controversial change in CuttingEdge.Conditions">controversial breaking change in CuttingEdge.Conditions</a>.</p><p>Today I want to write about another breaking change that I'll be making in the <a rel="external" href="http://conditions.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=31750" title="CuttingEdge.Conditions v1.0">coming stable release</a> of CuttingEdge.Conditions: I'm removing the <span class="code">Otherwise&lt;TException&gt;</span> methods from the library.</p><p>The <span class="code">Otherwise&lt;T&gt;</span> method overloads let users define the exception type that has to be thrown. Normally the library throws an <span class="type">ArgumentException</span> (using Requires) or <span class="type">PostconditionException</span> (using Ensures). Sometimes however, it's useful to throw another exception type and with the beta releases, CuttingEdge.Conditions lets you do this.</p><p>The name of the <span class="code">Otherwise</span> method is based on <a rel="external" href="http://research.microsoft.com/en-us/projects/specsharp/" title="Microsoft Research - Spec#">Spec#</a> (SpecSharp). I looked closely at the Spec# language, while designing CuttingEdge.Conditions. Besides <span class="keyword">requires</span> and <span class="keyword">ensures</span>, Spec# defines an <span class="keyword">otherwise</span> keyword. <a rel="external" href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=36#The_API_must_use_the_same_terminology_as_SpecSharp_does" title=".NET Junkie - My Own Fluent Argument Validation Library - requirement: The API must use the same terminology as Spec# does">One of the requirements</a> I had in the <a rel="external" href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=36" title=".NET Junkie - My Own Fluent Argument Validation Library">initial design</a> of Conditions was to use the same terminology as Spec#.</p><p>There are however, two problems with Otherwise:</p><h6>1. The name of the method doesn't properly describe its intend.</h6><p>While Otherwise follows Spec#, I noticed developers find the name confusing. While documentation helps, I think it&rsquo;s name can be improved. This means that I break with the initial requirement of staying close to Spec#, but I think this is okay. It could take years before Spec# (or its syntax) becomes mainstream I think it&rsquo;s better to make a library that&rsquo;s usable right now.</p><h6>2. The use isn't intuitive, which leads to programming mistakes.</h6><p>Perhaps it's the lack of proper documentation, lack of proper code samples, or simply a quirk in the design, but I recently experienced developers writing code like this:</p><pre class="cs badcode_top" language="csharp" customtypes="Condition InvalidOperationException" customvaluetypes="PutYourCustomValueTypesHere"><br />Condition.Requires(x)<br />    .IsNotNull()<br />    .Otherwise&lt;InvalidOperationException&gt;();<br /><br /></pre><p>The developers who wrote this code, expected an <span class="type">InvalidOperationException</span> to be thrown when x was null. This is not the case however. This code throws an <span class="type">ArgumentNullException</span>. The <span class="code">Requires()</span>, <span class="code">Ensures()</span>, and <span class="code">Otherwise()</span> methods return an object that will be passed to validation methods such as the <span class="code">IsNotNull()</span> method in the snippet above. That object determines the exception type to be thrown. When the <span class="code">Otherwise</span> is specified last, the object it returns will never get used. The right way to write this is:</p><pre class="cs" language="csharp" customtypes="Condition InvalidOperationException" customvaluetypes="PutYourCustomValueTypesHere">Condition.Requires(x)<br />    .Otherwise&lt;InvalidOperationException&gt;()<br />    .IsNotNull();<br /></pre><p>The problem however is that this is perhaps not as intuitive as I had expected.<br /><br />For these two reasons I'm not sure the current implementation is the right one. However, it's not clear to me what the correct design is. I'm finalizing the first stable release of the library at the moment. Leaving the current implementation in, means I can never change or remove it, without introducing a breaking change in a stable product. This would possibly lead to many angry users, which is something I like to prevent.<br /><br />While I know I might frustrate users of the current beta release, for most of them, <span class="code">Otherwise</span> is a rarely used feature. Therefore I think it's better to remove it before the stable release and let the user community participate in an improved design of the otherwise feature.<br /><br />The consequence of this change is that users will have to revert to using old fashion &lsquo;<span class="keyword">if</span><span class="code"> (...) </span><span class="keyword">throw</span><span class="code"> ex</span>&rsquo; statements in these situations. Although I published some code that could be added to your code base that fixed the breaking change I discussed <a rel="external" href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=57" title=".NET Junkie - Controversial change in CuttingEdge.Conditions">two days ago</a>, this isn&rsquo;t possible in this case. It&rsquo;s not possible to supply code that will prevent you from making changes throughout your code base. <br /><br />But if you&rsquo;re so hooked on this way of validating that you don&rsquo;t want to go back to old fashion throw statements, please <a rel="external" href="http://conditions.codeplex.com/Thread/List.aspx" title="CuttingEdge.Conditions - Discussions on Code Plex">participate</a> and let us together get a better implementation. Also if you&rsquo;re really interested, I have an implementation with a slightly different syntax, that you actually can use in your own code base. If you&rsquo;re interested, let me know.</p><p>Cheers</p>
					</div>
					
					<div id="listOfLinks"></div>
					
					<p class="info dontPrint">
						<span class="poster"><script type="text/javascript">
<!--
	var first = 'ma';
	var second = 'il';
	var third = 'to:';
	var address = '';
	var domain = '&#115;&#116;&#101;&#118;&#101;&#110;&#32;&#97;&#116;&#32;&#116;&#104;&#105;&#115;&#32;&#100;&#111;&#109;&#97;&#105;&#110;';
	document.write('<a href="');
	document.write(first+second+third);
	document.write(address);
	document.write('&#64;');
	document.write(domain);
	document.write('" title="Email Steven">');
	document.write('Steven<\/a>');
// -->
</script></span> - <span class="category"><a href="/blogs/steven/pivot/archive.php?c=.NET_General">.NET General</a>, <a href="/blogs/steven/pivot/archive.php?c=6">C#</a>, <a href="/blogs/steven/pivot/archive.php?c=CuttingEdge.Conditions">CuttingEdge.Conditions</a>, <a href="/blogs/steven/pivot/archive.php?c=LINQ">LINQ</a></span> - 
						<span class="comments"><a href="/blogs/steven/pivot/entry.php?id=58#comm" title="">No comments</a> /  <a href="/blogs/steven/pivot/entry.php?id=58#track" title="">No trackbacks</a></span> - 
						<a href="/blogs/steven/archives/archive_2009-m08.php#e58" title="Permanent link to 'Removing Otherwise method from CuttingEdge.Conditions' in the archives">&sect;</a> <a href="/blogs/steven/pivot/entry.php?id=58" title="Permanent link to entry 'Removing Otherwise method from CuttingEdge.Conditions'">&para;</a> 
					</p>
					
					<div id="NoJavascriptWarning">
						The code samples on my weblog are colorized using javascript, but
						you disabled javascript (for my website) on your browser. 
						If you're interested in viewing the posted code snippets in 
						color, please enable javascript.
					</div>
					<script type="text/javascript">
						var noScriptWarning = document.getElementById('NoJavascriptWarning');
						noScriptWarning.style.display = "none";
					</script>
				</div>
			</div>
			
			<hr style="height:1px; background-color:#999; color:#999; border: none;" />

			<p><b>No comments:</b></p>
			<div class="comments">
			<a id="comm"></a>

			</div>

		</div>

		<hr />
		
		<div id="footer">
			<p>&copy; 2007-2019 Steven van Deursen.<br /><span class="dontPrint"><a href="/blogs/steven/rss.xml" title="XML: RSS Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/rssbutton.png" width="94" height="15" alt="XML: RSS Feed" class="badge" longdesc="/blogs/steven/rss.xml" /></a> <a href="/blogs/steven/atom.xml" title="XML: Atom Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/atombutton.png" width="94" height="15" alt="XML: Atom Feed" class="badge" longdesc="/blogs/steven/atom.xml" /></a></span>
			</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/blogs/steven/pivot/templates/CSharpCodeHighlighter0.10.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/MSILCodeHighlighter0.1.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/X86CodeHighlighter0.1.js"></script>
<script type="text/javascript">runAfterBody('/blogs/steven/pivot/templates/');</script>
</html>