<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>.NET Junkie - Mixing Validation Application Block With DataAnnotation: What About SelfValidation?</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout12.css" type="text/css" />
	<!--[if IE]>
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ie.css" type="text/css" />
	<![endif]-->
	<!--[if !IE]>-->
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ff.css" type="text/css" />
	<!--<![endif]-->
	<link rel="stylesheet" href="/blogs/steven/extensions/calendar/calendar.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/mobile.css?changed=20121020a" type="text/css" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/print.css?changed=20110919" type="text/css" media="print" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/blogs/steven/rss.xml" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/blogs/steven/atom.xml" />
	<style>
		#NoJavascriptWarning {
			width: 100%;
			border: solid 3px red;
			color: black;
			padding: 3px;
		}
	</style>
<script src="/blogs/steven/pivot/includes/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
function TOtoRAFWdEIvwKe(){ $('input[@name=post]').attr('disabled', ''); }
function KC(q,a,b,x,s,t){return TpyPyS(MOipBW(TpyPyS(TpyPyS(a,q),TpyPyS(x,t)),s),b);}function Yh(a,b,c,d,x,s,t){return KC((b&c)|((~b)&d),a,b,x,s,t);} function UaYh(ebg){var gjC="0123456789abcdef";var str="";for(var i=0;i<ebg.length*4;i++){str+=gjC.charAt((ebg[i>>2]>>((i%4)*8+4))&0xF)+gjC.charAt((ebg[i>>2]>>((i%4)*8))&0xF);}return str;} function KSl(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=Yh(a,b,c,d,x[i+0],7,-680876936);d=Yh(d,a,b,c,x[i+1],12,-389564586);c=Yh(c,d,a,b,x[i+2],17,606105819);b=Yh(b,c,d,a,x[i+3],22,-1044525330);a=Yh(a,b,c,d,x[i+4],7,-176418897);d=Yh(d,a,b,c,x[i+5],12,1200080426);c=Yh(c,d,a,b,x[i+6],17,-1473231341);b=Yh(b,c,d,a,x[i+7],22,-45705983);a=Yh(a,b,c,d,x[i+8],7,1770035416);d=Yh(d,a,b,c,x[i+9],12,-1958414417);c=Yh(c,d,a,b,x[i+10],17,-42063);b=Yh(b,c,d,a,x[i+11],22,-1990404162);a=Yh(a,b,c,d,x[i+12],7,1804603682);d=Yh(d,a,b,c,x[i+13],12,-40341101);c=Yh(c,d,a,b,x[i+14],17,-1502002290);b=Yh(b,c,d,a,x[i+15],22,1236535329);a=Ozi(a,b,c,d,x[i+1],5,-165796510);d=Ozi(d,a,b,c,x[i+6],9,-1069501632);c=Ozi(c,d,a,b,x[i+11],14,643717713);b=Ozi(b,c,d,a,x[i+0],20,-373897302);a=Ozi(a,b,c,d,x[i+5],5,-701558691);d=Ozi(d,a,b,c,x[i+10],9,38016083);c=Ozi(c,d,a,b,x[i+15],14,-660478335);b=Ozi(b,c,d,a,x[i+4],20,-405537848);a=Ozi(a,b,c,d,x[i+9],5,568446438);d=Ozi(d,a,b,c,x[i+14],9,-1019803690);c=Ozi(c,d,a,b,x[i+3],14,-187363961);b=Ozi(b,c,d,a,x[i+8],20,1163531501);a=Ozi(a,b,c,d,x[i+13],5,-1444681467);d=Ozi(d,a,b,c,x[i+2],9,-51403784);c=Ozi(c,d,a,b,x[i+7],14,1735328473);b=Ozi(b,c,d,a,x[i+12],20,-1926607734);a=erVl(a,b,c,d,x[i+5],4,-378558);d=erVl(d,a,b,c,x[i+8],11,-2022574463);c=erVl(c,d,a,b,x[i+11],16,1839030562);b=erVl(b,c,d,a,x[i+14],23,-35309556);a=erVl(a,b,c,d,x[i+1],4,-1530992060);d=erVl(d,a,b,c,x[i+4],11,1272893353);c=erVl(c,d,a,b,x[i+7],16,-155497632);b=erVl(b,c,d,a,x[i+10],23,-1094730640);a=erVl(a,b,c,d,x[i+13],4,681279174);d=erVl(d,a,b,c,x[i+0],11,-358537222);c=erVl(c,d,a,b,x[i+3],16,-722521979);b=erVl(b,c,d,a,x[i+6],23,76029189);a=erVl(a,b,c,d,x[i+9],4,-640364487);d=erVl(d,a,b,c,x[i+12],11,-421815835);c=erVl(c,d,a,b,x[i+15],16,530742520);b=erVl(b,c,d,a,x[i+2],23,-995338651);a=uk(a,b,c,d,x[i+0],6,-198630844);d=uk(d,a,b,c,x[i+7],10,1126891415);c=uk(c,d,a,b,x[i+14],15,-1416354905);b=uk(b,c,d,a,x[i+5],21,-57434055);a=uk(a,b,c,d,x[i+12],6,1700485571);d=uk(d,a,b,c,x[i+3],10,-1894986606);c=uk(c,d,a,b,x[i+10],15,-1051523);b=uk(b,c,d,a,x[i+1],21,-2054922799);a=uk(a,b,c,d,x[i+8],6,1873313359);d=uk(d,a,b,c,x[i+15],10,-30611744);c=uk(c,d,a,b,x[i+6],15,-1560198380);b=uk(b,c,d,a,x[i+13],21,1309151649);a=uk(a,b,c,d,x[i+4],6,-145523070);d=uk(d,a,b,c,x[i+11],10,-1120210379);c=uk(c,d,a,b,x[i+2],15,718787259);b=uk(b,c,d,a,x[i+9],21,-343485551);a=TpyPyS(a,olda);b=TpyPyS(b,oldb);c=TpyPyS(c,oldc);d=TpyPyS(d,oldd);}return Array(a,b,c,d);} function IP(O){var V=Array();var F=(1<<8)-1;for(var i=0;i<O.length*8;i+=8)V[i>>5]|=(O.charCodeAt(i/8)&F)<<(i%32);return V;} function Ozi(a,b,c,d,x,s,t){return KC((b&d)|(c&(~d)),a,b,x,s,t);} function PMPfzEsRpMDKHwFnPY(s){return UaYh(KSl(IP(s),s.length*8));} function TpyPyS(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);} function uk(a,b,c,d,x,s,t){return KC(c ^(b|(~d)),a,b,x,s,t);} function dhYZCdeg(hIBIUyQKi){ GtPJqU = document.getElementById("iTXLUdC"); if(!GtPJqU){ return false; } else { GtPJqU.name = PMPfzEsRpMDKHwFnPY(hIBIUyQKi); GtPJqU.value = unxctSzsAjLxYQy(); return true; }} function MOipBW(num,cnt){return(num<<cnt)|(num>>>(32-cnt));} function erVl(a,b,c,d,x,s,t){return KC(b ^ c ^ d,a,b,x,s,t);} function unxctSzsAjLxYQy(){var fNpbChMN = 64; var i; for(i = 0; i <= 96; i++){ fNpbChMN += i; } return fNpbChMN; } 
$(document).ready(function(){ setTimeout("TOtoRAFWdEIvwKe()", 100); });
// -->
</script>

</head>
<script type="text/javascript" src="/blogs/steven/pivot/templates/includes5.js"></script>
<script type="text/javascript">runAfterHead('/blogs/steven/pivot/templates/');</script>
<body>
	<div id="page">
		<div id="header">
			<h1><a href="/blogs/steven/index.php" title=".NET Junkie">.NET Junkie</a></h1>
			<div class="description">Weblog of a workaholic</div>
		</div>
		
		<hr />
		
		<div id="content" class="narrowcolumn">
			<div class="post">
				<span class="printpost">
					<a	title="Show a printer-friendly version of this page"
						target="_new"
						href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80&print=true">
						<img alt="Print" src="/blogs/steven/pivot/templates/images/print.gif" />
					</a>
				</span>
				<div class="entry" id="entry">
					<span class="entrydate">12 September 10</span>
					<h3><a href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80">Mixing Validation Application Block With DataAnnotation: What About SelfValidation?</a></h3>
			
					<h4>This article describes how to move the self validation methods of a type to its meta data type, using Validation Application Block 5.0. Using self validation methods inside Data Annotations' meta data type is something that is not supported out of the box.</h4>
					
					<div id="entry_body">
						<a id="body"></a><p>The newest version of the Validation Application Block, version 5.0, now integrates with .NET Data Annotations (new since .NET 3.5 sp1). Data Annotations is a general model for annotating data using attributes, which is especially useful for validation. Attribute based validation is of course one of the options when doing validation using the Validation Application Block.</p><p>One of the nice things about Data Annotations is that it contains a feature called 'buddy classes', which allows you to put the validation attributes in a separate class that will function as meta data type. This is especially useful when dealing with auto-generated classes (think LINQ to SQL, Entity Framework). Validation Application Block 5.0 is now able to use this annotation model and we're therefore now able to do something like this with VAB:</p> <pre class="cs" language="csharp" customtypes="MetadataType PersonMetaData Person NotNullValidator" customvaluetypes="PutYourCustomValueTypesHere">// DataAnnotations Metadata attribute<br />[MetadataType(typeof(PersonMetaData))]<br />public partial class Person<br />{<br />    public string Name { get; set; }<br />}<br /> <br />public class PersonMetaData<br />{<br />&nbsp;&nbsp;&nbsp; // VAB validation attribute<br />    [NotNullValidator]<br />    public string Name { get; set; }<br />}</pre>  <p>This works great, but what about self validation? VAB allows methods to be placed on objects that allow custom validation logic that can't be written as custom attributes. How do we move this logic to the <span class="type">PersonMetaData</span> class?</p><p>The short answer is: you can't. VAB does not support this out of the box. However, for those of you who follow this series about the VAB, you already know by now that there is little that can't be done with the VAB with a bit of work.</p><p>Please note that I think that having such feature is probably only useful in a narrow range of scenarios, because self validation method can located in a partial class. For the sake of education and having fun with VAB, let's just do this anyway ;-) </p><p>This can be achieved by hooking into the framework using depedency injection and replace the existing <span class="type">AttributeValidationFactory</span> implementation. Below is a complete working example of how to do this with VAB 5.0 in three 'simple' steps:</p><ol><li>Change the signature of your validation methods.</li><li>Define a class that can replace the VAB's build-in <span class="type">AttributeValidationFactory</span>.</li><li>Reconfigure VAB in the start up path of your application.</li></ol><h4>1. Change the signature of your validation methods.</h4><p>Because self validation methods are instance methods they are able to validate instance fields on the validated type. When you move the validation method to the meta data type you loose this ability. So for this to work we'll have to change the signature of the validation method to at least contain the object to validate as method argument. When we make this validation method static we can prevent a new instance of the meta data type from being created during the validation process. Here is an example of a type that has its self validation moved to its meta data type:</p><pre class="cs" language="csharp" customtypes="MetadataType PersonMetaData Person NotNullValidator SelfValidation ValidationResults">[MetadataType(typeof(PersonMetaData))]<br />public class Person<br />{<br />&nbsp;&nbsp;&nbsp; public string Name { get; set; }<br />}<br /><br />public class PersonMetaData<br />{<br />&nbsp;&nbsp;&nbsp; [NotNullValidator]<br />&nbsp;&nbsp;&nbsp; public string Name { get; set; }<br /><br />&nbsp;&nbsp;&nbsp; [SelfValidation]<br />&nbsp;&nbsp;&nbsp; public static void SelfValidator(Person instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationResults results)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // TODO: Your validation here.<br />&nbsp;&nbsp;&nbsp; }<br />}</pre><h4>2. Define a class that can replace the VAB's build in AttributeValidatorFactory.</h4><p>When using attribute based validation, the&nbsp;<span class="type">AttributeValidationFactory</span> type, that lives in the <span class="code">Microsoft.Practices.EnterpriseLibrary.Validation</span> namespace, is responsible for creating new validators based on the attributes you decorated. When we replace it with an extended implementation that is able to handle self validations on the meta data class. Here is my <span class="type">ExtendedAttributeValidationFactory</span> implementation: </p><pre class="cs" language="csharp" customtypes="ExtendedAttributeValidationFactory AttributeValidatorFactory IValidationInstrumentationProvider Validator ValidatorFactory AndCompositeValidator MetadataTypeAttribute ValidationResults ValidationReflectionHelper SelfValidationAttribute MetaDataSelfValidationValidator" customvaluetypes="BindingFlags">public class ExtendedAttributeValidationFactory :<br />    AttributeValidatorFactory<br />{<br />    public ExtendedAttributeValidationFactory(<br />        IValidationInstrumentationProvider provider)<br />        : base(provider)<br />    {<br />    }<br /><br />    protected override Validator InnerCreateValidator(<br />        Type targetType, string ruleset,<br />        ValidatorFactory mainValidatorFactory)<br />    {<br />        var baseValidator = base.InnerCreateValidator(<br />            targetType, ruleset, mainValidatorFactory);<br /><br />        var metaDataValidator =<br />            CreateValidatorForMetaDataSelfValidation(<br />                targetType, ruleset);<br /><br />        if (metaDataValidator == null)<br />        {<br />            return baseValidator;<br />        }<br /><br />        return new AndCompositeValidator(baseValidator,<br />            metaDataValidator);<br />    }<br /><br />    private Validator CreateValidatorForMetaDataSelfValidation(<br />        Type targetType, string ruleset)<br />    {<br />        var attributes = GetMetadataTypes(targetType).ToArray();<br /><br />        if (attributes.Length == 0)<br />            return null;<br /><br />        var flags = BindingFlags.Public |<br />            BindingFlags.NonPublic | BindingFlags.Static;<br /><br />        var selfValidators = (<br />            from attribute in attributes<br />            from method in attribute.MetadataClassType.GetMethods(flags)<br />            where method.ReturnType == typeof(void)<br />            let parameters = method.GetParameters()<br />            where parameters.Length == 2<br />            where parameters[1].ParameterType == typeof(ValidationResults)<br />            from methodAtrtibute in<br />                ValidationReflectionHelper.GetCustomAttributes(method,<br />                    typeof(SelfValidationAttribute), false)<br />                .Cast&lt;SelfValidationAttribute&gt;()<br />            where ruleset.Equals(methodAtrtibute.Ruleset)<br />            select new MetaDataSelfValidationValidator(method)).ToArray();<br /><br />        if (selfValidators.Length == 0)<br />            return null;<br /><br />        return new AndCompositeValidator(selfValidators);<br />    }<br /><br />    private static IEnumerable&lt;MetadataTypeAttribute&gt; GetMetadataTypes(<br />        Type targetType)<br />    {<br />        while (targetType != null)<br />        {<br />            var metadata = targetType.GetCustomAttributes(<br />                typeof(MetadataTypeAttribute), false)<br />                .FirstOrDefault();<br /><br />            if (metadata != null)<br />            {<br />                yield return (MetadataTypeAttribute)metadata;<br />            }<br /><br />            targetType = targetType.BaseType;<br />        }<br />    }<br />}<br /></pre><p>The <span class="type">ExtendedAttributeValidationFactory</span> class loops through all static methods of the meta data class and foreach method that follows the conventions and is of the correct ruleset, a new <span class="type">MetaDataSelfValidationValidator</span> is created. These are the conventions a validation method must follow:</p><ul><li>The method must be static.</li><li>The method must return void.</li><li>The method must contain two arguments.</li><li>The first argument must be of the validated type or a base type.</li><li>The second argument must be of type <span class="type">ValidationResults</span>.</li><li>The method must be decorated with the <span class="code">[</span><span class="type">SelfValidationAttribute</span><span class="code">]</span>.</li></ul><p>The <span class="type">MetaDataSelfValidationValidator</span> class enables validation of an object by calling the static self validation method of the meta data type. Here's the code:</p><pre class="cs" language="csharp" customtypes="MetaDataSelfValidationValidator Validator MethodInfo ValidationResults">public class MetaDataSelfValidationValidator : Validator<br />{<br />    private readonly MethodInfo methodInfo;<br /><br />    public MetaDataSelfValidationValidator(MethodInfo methodInfo) <br />        : base(null, null)<br />    {<br />        this.methodInfo = methodInfo;<br />    }<br /><br />    public override void DoValidate(object objectToValidate, <br />        object currentTarget, string key, <br />        ValidationResults validationResults)<br />    {<br />        if (objectToValidate != null)<br />        {<br />            this.methodInfo.Invoke(null, <br />                new object[] { objectToValidate, validationResults });<br />        }<br />    }<br /><br />    protected override string DefaultMessageTemplate<br />    {<br />        get { return null; }<br />    }<br />}<br /></pre><h4>3. Reconfigure VAB in the start up path of your application.</h4><p>Now we've written a new implementation of the <span class="type">AttributeValidationFactory</span>, we will have to replace the current implementation with this new one. We can do this by reconfiguring the Unity container (the standard IoC framework for EntLib) to return a new instance of the <span class="type">ExtendedAttributeValidationFactory</span> type when an <span class="type">AttributeValidationFactory</span> is requested by VAB:</p><pre class="cs" language="csharp" customtypes="IConfigurationSource UnityContainer UnityContainerConfigurator AttributeValidatorFactory ExtendedAttributeValidationFactory IServiceLocator UnityServiceLocator EnterpriseLibraryContainer">// Create the container<br />var container = new UnityContainer();<br /><br />// Configurator will read Enterprise Library <br />// configuration and set up the container<br />var configurator = new UnityContainerConfigurator(container);<br /><br />IConfigurationSource configurationSource = <br />    new NullConfigurationSource();<br />EnterpriseLibraryContainer.ConfigureContainer(<br />    configurator, configurationSource);<br /><br />container.RegisterType&lt;AttributeValidatorFactory, <br />    ExtendedAttributeValidationFactory&gt;();<br /><br />// Wrap in ServiceLocator<br />IServiceLocator locator = new UnityServiceLocator(container);<br /><br />// And set Enterprise Library to use it<br />EnterpriseLibraryContainer.Current = locator;<br /></pre><p>Happy self validating ;-)</p>
					</div>
					
					<div id="listOfLinks"></div>
					
					<p class="info dontPrint">
						<span class="poster"><script type="text/javascript">
<!--
	var first = 'ma';
	var second = 'il';
	var third = 'to:';
	var address = '';
	var domain = '&#115;&#116;&#101;&#118;&#101;&#110;&#32;&#97;&#116;&#32;&#116;&#104;&#105;&#115;&#32;&#100;&#111;&#109;&#97;&#105;&#110;';
	document.write('<a href="');
	document.write(first+second+third);
	document.write(address);
	document.write('&#64;');
	document.write(domain);
	document.write('" title="Email Steven">');
	document.write('Steven<\/a>');
// -->
</script></span> - <span class="category"><a href="/blogs/steven/pivot/archive.php?c=.NET_General">.NET General</a>, <a href="/blogs/steven/pivot/archive.php?c=6">C#</a>, <a href="/blogs/steven/pivot/archive.php?c=Enterprise_Library">Enterprise Library</a>, <a href="/blogs/steven/pivot/archive.php?c=Validation_Application_Block">Validation Application Block</a></span> - 
						<span class="comments"><a href="/blogs/steven/pivot/entry.php?id=80#comm" title="Steven, ahue">six comments</a> /  <a href="/blogs/steven/pivot/entry.php?id=80#track" title="">No trackbacks</a></span> - 
						<a href="/blogs/steven/archives/archive_2010-m09.php#e80" title="Permanent link to 'Mixing Validation Application Block With DataAnnotation: What About SelfValidation?' in the archives">&sect;</a> <a href="/blogs/steven/pivot/entry.php?id=80" title="Permanent link to entry 'Mixing Validation Application Block With DataAnnotation: What About SelfValidation?'">&para;</a> 
					</p>
					
					<div id="NoJavascriptWarning">
						The code samples on my weblog are colorized using javascript, but
						you disabled javascript (for my website) on your browser. 
						If you're interested in viewing the posted code snippets in 
						color, please enable javascript.
					</div>
					<script type="text/javascript">
						var noScriptWarning = document.getElementById('NoJavascriptWarning');
						noScriptWarning.style.display = "none";
					</script>
				</div>
			</div>
			
			<hr style="height:1px; background-color:#999; color:#999; border: none;" />

			<p><b>six comments:</b></p>
			<div class="comments">
			<a id="comm"></a>
<p>Kevin, if you've got a problem with getting this to work, or VAB in general, please ask a question at Stackoverflow.com. SO is much more suited for this than my blog. Be as specific as you can about your problem. If you post a link to SO here, I will definitely take a look.<br /><small><b>Steven</b>  (<a href='http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80'  title='www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80'>URL</a>) - 05 10 10 - 14:04 </small></p>
<p>Hey, this is an interesting and helpful article! However, it does not work with my implementation.<br />
<br />
I copied the (unchanged) ExtendedAttributeValidationFactory and MetaDataSelfValidationValidator to a Namespace called VABExtension and put the reconfiguration (step 3) in the startup section of my program.<br />
<br />
When trying to create a validator for Foobar using<br />
<br />
ValidationFactory.CreateValidator()<br />
<br />
an exception is thrown stating &quot;Activation error occured while trying to get instance of type ValidatorFactory, key &quot;&quot;&quot;<br />
<br />
If it helps, i can also post the stack trace here.<br />
<br />
Did I miss something adopting your solution?<br /><small><b>ahue</b>   - 13 11 11 - 12:52 </small></p>
<p>The call to EnterpriseLibraryContainer.ConfigureContainer was missing from the last code snippet. I added it.<br /><small><b>Steven</b>  (<a href='http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80'  title='www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80'>URL</a>) - 19 11 11 - 20:33 </small></p>
<p>Hey Steven,<br />
thank you very much for your help with that! I'm sorry I didn't respond earlier, but I couldn't test your fix until now. It works fine! Thank you so much, again, without you I would've been stuck!<br />
Cheers!<br /><small><b>ahue</b>   - 28 11 11 - 23:03 </small></p>
<p>Hey,<br />
another piece of feedback goes here: It seems that SelfValidation does not work for subclasses of the class, the SelfValidation was specified for. Consider the following case:<br />
<br />
A type hierarchy:<br />
<br />
[MetadataType(typeof(MetaA))]<br />
class A {<br />
  public int alpha;<br />
}<br />
[MetadataType(typeof(MetaB))]<br />
class B : A {<br />
  public int beta;<br />
}<br />
<br />
class MetaA {<br />
  [RangeValidator(...)]<br />
  public int alpha;<br />
<br />
  [SelfValidation]<br />
  public static void Self(A instance, ValidationResults results) {...}<br />
}<br />
<br />
class MetaB {<br />
  [RangeValidator(...)]<br />
  public int beta;<br />
}<br />
<br />
b = new B();<br />
var vA = ValidationFactory.CreateValidator&lt;A&gt;();<br />
var resA = vA.Validate(b);<br />
<br />
var vB = ValidationFactory.CreateValidator&lt;B&gt;();<br />
var resB = vB.Validate(b);<br />
<br />
---<br />
So, consider b has invalid values for alpha and beta, and validation of b would fail for SelfValidation "Self":<br />
<br />
resA contains 2 results, one for alpha, and one for Self - everythin is fine.<br />
resB contains 2 results, one for alpha, and one for beta, but the one for Self is missing. In my understanding of validation, Self should also be carried out for b, otherwise it'd be inconsistent since other validators in MetaA are applied to b.<br />
<br />
Do you have any idea how to fix this?<br /><small><b>ahue</b>   - 04 12 11 - 11:56 </small></p>
<a id="lastcomment"></a><p>The ExtendedAttributeValidationFactory only took the first MetadataTypeAttribute it found and used that. I updated the code. Now it searches the inheritance hierarchy of the type looking for all MetadataTypeAttributes and searches all metadata types for self validation methods.<br /><small><b>Steven</b>  (<a href='http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80'  title='www.cuttingedge.it/blogs/steven/pivot/entry.php?id=80'>URL</a>) - 04 12 11 - 12:52 </small></p>

			</div>

		</div>

		<hr />
		
		<div id="footer">
			<p>&copy; 2007-2019 Steven van Deursen.<br /><span class="dontPrint"><a href="/blogs/steven/rss.xml" title="XML: RSS Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/rssbutton.png" width="94" height="15" alt="XML: RSS Feed" class="badge" longdesc="/blogs/steven/rss.xml" /></a> <a href="/blogs/steven/atom.xml" title="XML: Atom Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/atombutton.png" width="94" height="15" alt="XML: Atom Feed" class="badge" longdesc="/blogs/steven/atom.xml" /></a></span>
			</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/blogs/steven/pivot/templates/CSharpCodeHighlighter0.10.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/MSILCodeHighlighter0.1.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/X86CodeHighlighter0.1.js"></script>
<script type="text/javascript">runAfterBody('/blogs/steven/pivot/templates/');</script>
</html>