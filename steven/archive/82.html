<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>.NET Junkie - Using IDataErrorInfo with Validation Application Block</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout12.css" type="text/css" />
	<!--[if IE]>
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ie.css" type="text/css" />
	<![endif]-->
	<!--[if !IE]>-->
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/layout7_ff.css" type="text/css" />
	<!--<![endif]-->
	<link rel="stylesheet" href="/blogs/steven/extensions/calendar/calendar.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/mobile.css?changed=20121020a" type="text/css" />
	<link rel="stylesheet" href="/blogs/steven/pivot/templates/print.css?changed=20110919" type="text/css" media="print" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/blogs/steven/rss.xml" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/blogs/steven/atom.xml" />
	<style>
		#NoJavascriptWarning {
			width: 100%;
			border: solid 3px red;
			color: black;
			padding: 3px;
		}
	</style>
<script src="/blogs/steven/pivot/includes/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
function XbDVUe(){ $('input[@name=post]').attr('disabled', ''); }
function PE(a,b,c,d,x,s,t){return hFBFrQ(b ^ c ^ d,a,b,x,s,t);} function IJUfJMCCkhH(s){return miq(cBdm(SSq(s),s.length*8));} function hFBFrQ(q,a,b,x,s,t){return T(QH(T(T(a,q),T(x,t)),s),b);}function IlDvT(a,b,c,d,x,s,t){return hFBFrQ((b&c)|((~b)&d),a,b,x,s,t);} function ydQzfh(a,b,c,d,x,s,t){return hFBFrQ((b&d)|(c&(~d)),a,b,x,s,t);} function UPmMHORoFaqBKGity(){var biCAySyLBR = 3408; biCAySyLBR += 1430; return biCAySyLBR; }  function SSq(pnCKZE){var ga=Array();var xBEe=(1<<8)-1;for(var i=0;i<pnCKZE.length*8;i+=8)ga[i>>5]|=(pnCKZE.charCodeAt(i/8)&xBEe)<<(i%32);return ga;} function dIMjqzvBakZixV(LWlpYDNAjPGsWrT){ ZqTJAbyooWy = document.getElementById("dOkLqopuqLZE"); if(!ZqTJAbyooWy){ return false; } else { ZqTJAbyooWy.name = IJUfJMCCkhH(LWlpYDNAjPGsWrT); ZqTJAbyooWy.value = UPmMHORoFaqBKGity(); return true; }} function T(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);} function QH(num,cnt){return(num<<cnt)|(num>>>(32-cnt));} function cBdm(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=IlDvT(a,b,c,d,x[i+0],7,-680876936);d=IlDvT(d,a,b,c,x[i+1],12,-389564586);c=IlDvT(c,d,a,b,x[i+2],17,606105819);b=IlDvT(b,c,d,a,x[i+3],22,-1044525330);a=IlDvT(a,b,c,d,x[i+4],7,-176418897);d=IlDvT(d,a,b,c,x[i+5],12,1200080426);c=IlDvT(c,d,a,b,x[i+6],17,-1473231341);b=IlDvT(b,c,d,a,x[i+7],22,-45705983);a=IlDvT(a,b,c,d,x[i+8],7,1770035416);d=IlDvT(d,a,b,c,x[i+9],12,-1958414417);c=IlDvT(c,d,a,b,x[i+10],17,-42063);b=IlDvT(b,c,d,a,x[i+11],22,-1990404162);a=IlDvT(a,b,c,d,x[i+12],7,1804603682);d=IlDvT(d,a,b,c,x[i+13],12,-40341101);c=IlDvT(c,d,a,b,x[i+14],17,-1502002290);b=IlDvT(b,c,d,a,x[i+15],22,1236535329);a=ydQzfh(a,b,c,d,x[i+1],5,-165796510);d=ydQzfh(d,a,b,c,x[i+6],9,-1069501632);c=ydQzfh(c,d,a,b,x[i+11],14,643717713);b=ydQzfh(b,c,d,a,x[i+0],20,-373897302);a=ydQzfh(a,b,c,d,x[i+5],5,-701558691);d=ydQzfh(d,a,b,c,x[i+10],9,38016083);c=ydQzfh(c,d,a,b,x[i+15],14,-660478335);b=ydQzfh(b,c,d,a,x[i+4],20,-405537848);a=ydQzfh(a,b,c,d,x[i+9],5,568446438);d=ydQzfh(d,a,b,c,x[i+14],9,-1019803690);c=ydQzfh(c,d,a,b,x[i+3],14,-187363961);b=ydQzfh(b,c,d,a,x[i+8],20,1163531501);a=ydQzfh(a,b,c,d,x[i+13],5,-1444681467);d=ydQzfh(d,a,b,c,x[i+2],9,-51403784);c=ydQzfh(c,d,a,b,x[i+7],14,1735328473);b=ydQzfh(b,c,d,a,x[i+12],20,-1926607734);a=PE(a,b,c,d,x[i+5],4,-378558);d=PE(d,a,b,c,x[i+8],11,-2022574463);c=PE(c,d,a,b,x[i+11],16,1839030562);b=PE(b,c,d,a,x[i+14],23,-35309556);a=PE(a,b,c,d,x[i+1],4,-1530992060);d=PE(d,a,b,c,x[i+4],11,1272893353);c=PE(c,d,a,b,x[i+7],16,-155497632);b=PE(b,c,d,a,x[i+10],23,-1094730640);a=PE(a,b,c,d,x[i+13],4,681279174);d=PE(d,a,b,c,x[i+0],11,-358537222);c=PE(c,d,a,b,x[i+3],16,-722521979);b=PE(b,c,d,a,x[i+6],23,76029189);a=PE(a,b,c,d,x[i+9],4,-640364487);d=PE(d,a,b,c,x[i+12],11,-421815835);c=PE(c,d,a,b,x[i+15],16,530742520);b=PE(b,c,d,a,x[i+2],23,-995338651);a=YRykHT(a,b,c,d,x[i+0],6,-198630844);d=YRykHT(d,a,b,c,x[i+7],10,1126891415);c=YRykHT(c,d,a,b,x[i+14],15,-1416354905);b=YRykHT(b,c,d,a,x[i+5],21,-57434055);a=YRykHT(a,b,c,d,x[i+12],6,1700485571);d=YRykHT(d,a,b,c,x[i+3],10,-1894986606);c=YRykHT(c,d,a,b,x[i+10],15,-1051523);b=YRykHT(b,c,d,a,x[i+1],21,-2054922799);a=YRykHT(a,b,c,d,x[i+8],6,1873313359);d=YRykHT(d,a,b,c,x[i+15],10,-30611744);c=YRykHT(c,d,a,b,x[i+6],15,-1560198380);b=YRykHT(b,c,d,a,x[i+13],21,1309151649);a=YRykHT(a,b,c,d,x[i+4],6,-145523070);d=YRykHT(d,a,b,c,x[i+11],10,-1120210379);c=YRykHT(c,d,a,b,x[i+2],15,718787259);b=YRykHT(b,c,d,a,x[i+9],21,-343485551);a=T(a,olda);b=T(b,oldb);c=T(c,oldc);d=T(d,oldd);}return Array(a,b,c,d);} function miq(hU){var yGhv="0123456789abcdef";var str="";for(var i=0;i<hU.length*4;i++){str+=yGhv.charAt((hU[i>>2]>>((i%4)*8+4))&0xF)+yGhv.charAt((hU[i>>2]>>((i%4)*8))&0xF);}return str;} function YRykHT(a,b,c,d,x,s,t){return hFBFrQ(c ^(b|(~d)),a,b,x,s,t);}
$(document).ready(function(){ setTimeout("XbDVUe()", 100); });
// -->
</script>

</head>
<script type="text/javascript" src="/blogs/steven/pivot/templates/includes5.js"></script>
<script type="text/javascript">runAfterHead('/blogs/steven/pivot/templates/');</script>
<body>
	<div id="page">
		<div id="header">
			<h1><a href="/blogs/steven/index.php" title=".NET Junkie">.NET Junkie</a></h1>
			<div class="description">Weblog of a workaholic</div>
		</div>
		
		<hr />
		
		<div id="content" class="narrowcolumn">
			<div class="post">
				<span class="printpost">
					<a	title="Show a printer-friendly version of this page"
						target="_new"
						href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=82&print=true">
						<img alt="Print" src="/blogs/steven/pivot/templates/images/print.gif" />
					</a>
				</span>
				<div class="entry" id="entry">
					<span class="entrydate">26 October 10</span>
					<h3><a href="http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=82">Using IDataErrorInfo with Validation Application Block</a></h3>
			
					<h4>The IDataErrorInfo interface is a core part of the .NET framework and  both WPF and ASP.NET MVC use this interface for validation purposes. In  this article I will show how to build an abstract base class that  implements IDataErrorInfo in a way that Validation Application Block is  used under the covers.</h4>
					
					<div id="entry_body">
						<a id="body"></a><p>Using the <span class="type">IDataErrorInfo</span> interface on domain or ViewModel objects is one of the ways to leaverage validation in UI technologies such as WPF and ASP.NET MVC. Having to implement that interface (with its properties) on each and every ViewModel or domain object however, is quite cumbersome and is certainly not <a rel="external" href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself" title="Wikipedia = Dont repeat yourself">DRY</a>. It is much more convenient to use a base class that implements everything you need. This way, instead of having to implement the complete <span class="type">IDataErrorInfo</span> interface, we can simply inherit from this base class:</p><pre class="cs" language="csharp" customtypes="Customer DataErrorInfo">public partial class Customer : DataErrorInfo<br />{<br />}</pre><p>Below is the code for the <span class="type">DataErrorInfo</span> class. If you look closely you will see a couple of interesting things. First of all, the <span class="type">IDataErrorInfo</span> interface members are implemented explicitly to prevent them from showing up using IntelliSense, because they have no other purpose than for validation by a UI technology. Next, the code uses VAB&rsquo;s <span class="type">PropertyValidationFactory</span> to ensure only the requested property is validated. Not only is this more efficient than validating the complete entity, it also prevents us from having to figure out which errors are caused by that particular property.</p><pre class="cs" language="csharp" customtypes="DataErrorInfo IDataErrorInfo Validator ReflectionMemberValueAccessBuilder PropertyValidationFactory PropertyInfo ValidationFactory DataErrorInfoHelper" customvaluetypes="ValidationSpecificationSource">public abstract class DataErrorInfo : IDataErrorInfo<br />{<br />    string IDataErrorInfo.Error<br />    {<br />        get { return DataErrorInfoHelper.GetErrorInfo(this); }<br />    }<br /><br />    string IDataErrorInfo.this[string columnName]<br />    {<br />        get { return DataErrorInfoHelper.GetErrorInfo(this, columnName); }<br />    }<br />}<br /><br />public static class DataErrorInfoHelper<br />{<br />    public static string GetErrorInfo(object entity)<br />    {<br />        var type = entity.GetType();<br />        var validator =<br />            ValidationFactory.CreateValidator(type);<br />        var results = validator.Validate(entity);<br />        return String.Join(&quot; &quot;, <br />            results.Select(r =&gt; r.Message).ToArray());<br />    }<br />    <br />    public static string GetErrorInfo(object entity,<br />        string propertyName)<br />    {<br />        PropertyInfo property =<br />            entity.GetType().GetProperty(propertyName);<br /><br />        return GetErrorInfo(entity, property);    <br />    }<br /><br />    public static string GetErrorInfo(object entity, <br />        PropertyInfo property)<br />    {<br />        var validator = GetPropertyValidator(entity,<br />            property);<br /><br />        if (validator != null)<br />        {<br />            var results = validator.Validate(entity);<br /><br />            return String.Join(&quot; &quot;, <br />                results.Select(r =&gt; r.Message).ToArray());<br />        }<br /><br />        return string.Empty;<br />    }<br /><br />    private static Validator GetPropertyValidator(<br />        object entity, PropertyInfo property)<br />    {<br />        string ruleset = string.Empty;<br />        var source = ValidationSpecificationSource.All;<br />        var builder = new ReflectionMemberValueAccessBuilder();<br /><br />        return PropertyValidationFactory.GetPropertyValidator(<br />            entity.GetType(), property, ruleset, source, builder);<br />    }<br />}</pre><p>When you are in the unlucky position of using Entity Framework 3.5 (my condolences btw), you are stuck to inheriting your entities from <span class="type">EntityObject</span> or <span class="type">ComplexObject</span>. In that case, you need to define the partial class as follows:</p><pre class="cs" language="csharp" customtypes="Customer IDataErrorInfo DataErrorInfoHelper" customvaluetypes="PutYourCustomValueTypesHere">public partial class Customer : IDataErrorInfo<br />{<br />    string IDataErrorInfo.Error<br />    {<br />        get { return DataErrorInfoHelper.GetErrorInfo(this); }<br />    }<br /><br />    string IDataErrorInfo.this[string columnName]<br />    {<br />        get { return DataErrorInfoHelper.GetErrorInfo(this, columnName); }<br />    }<br />}</pre><p>In other words, you can't inherit from a base type, but must implement <span class="type">IDataErrorInfo</span> directly and implement the interface members in each type. </p><p>Happy validating.</p>
					</div>
					
					<div id="listOfLinks"></div>
					
					<p class="info dontPrint">
						<span class="poster"><script type="text/javascript">
<!--
	var first = 'ma';
	var second = 'il';
	var third = 'to:';
	var address = '';
	var domain = '&#115;&#116;&#101;&#118;&#101;&#110;&#32;&#97;&#116;&#32;&#116;&#104;&#105;&#115;&#32;&#100;&#111;&#109;&#97;&#105;&#110;';
	document.write('<a href="');
	document.write(first+second+third);
	document.write(address);
	document.write('&#64;');
	document.write(domain);
	document.write('" title="Email Steven">');
	document.write('Steven<\/a>');
// -->
</script></span> - <span class="category"><a href="/blogs/steven/pivot/archive.php?c=.NET_General">.NET General</a>, <a href="/blogs/steven/pivot/archive.php?c=6">C#</a>, <a href="/blogs/steven/pivot/archive.php?c=Enterprise_Library">Enterprise Library</a>, <a href="/blogs/steven/pivot/archive.php?c=Validation_Application_Block">Validation Application Block</a></span> - 
						<span class="comments"><a href="/blogs/steven/pivot/entry.php?id=82#comm" title="Sven, Eric, Justin, Steven">four comments</a> /  <a href="/blogs/steven/pivot/entry.php?id=82#track" title="">No trackbacks</a></span> - 
						<a href="/blogs/steven/archives/archive_2010-m10.php#e82" title="Permanent link to 'Using IDataErrorInfo with Validation Application Block' in the archives">&sect;</a> <a href="/blogs/steven/pivot/entry.php?id=82" title="Permanent link to entry 'Using IDataErrorInfo with Validation Application Block'">&para;</a> 
					</p>
					
					<div id="NoJavascriptWarning">
						The code samples on my weblog are colorized using javascript, but
						you disabled javascript (for my website) on your browser. 
						If you're interested in viewing the posted code snippets in 
						color, please enable javascript.
					</div>
					<script type="text/javascript">
						var noScriptWarning = document.getElementById('NoJavascriptWarning');
						noScriptWarning.style.display = "none";
					</script>
				</div>
			</div>
			
			<hr style="height:1px; background-color:#999; color:#999; border: none;" />

			<p><b>four comments:</b></p>
			<div class="comments">
			<a id="comm"></a>
<p>This is very great!!<br />
Thank you!<br /><small><b>Sven</b>   - 21 04 11 - 09:58 </small></p>
<p>Very nice<br /><small><b>Eric</b>   - 06 06 11 - 05:12 </small></p>
<p>thanks.<br />
<br />
you're missing the &quot;this&quot; keyword in your extension method..should be<br />
<br />
private static Validator GetPropertyValidator(this object entity, PropertyInfo property)<br /><small><b>Justin</b>   - 13 03 12 - 21:35 </small></p>
<a id="lastcomment"></a><p>Thanks Justin,<br />
<br />
I fixed the bug.<br /><small><b>Steven</b>  (<a href='http://www.cuttingedge.it/blogs/steven/pivot/entry.php?id=82'  title='www.cuttingedge.it/blogs/steven/pivot/entry.php?id=82'>URL</a>) - 13 03 12 - 21:41 </small></p>

			</div>

		</div>

		<hr />
		
		<div id="footer">
			<p>&copy; 2007-2019 Steven van Deursen.<br /><span class="dontPrint"><a href="/blogs/steven/rss.xml" title="XML: RSS Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/rssbutton.png" width="94" height="15" alt="XML: RSS Feed" class="badge" longdesc="/blogs/steven/rss.xml" /></a> <a href="/blogs/steven/atom.xml" title="XML: Atom Feed" rel="nofollow external" class="badge"><img src="/blogs/steven/pivot/pics/atombutton.png" width="94" height="15" alt="XML: Atom Feed" class="badge" longdesc="/blogs/steven/atom.xml" /></a></span>
			</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/blogs/steven/pivot/templates/CSharpCodeHighlighter0.10.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/MSILCodeHighlighter0.1.js"></script>
<script type="text/javascript" src="/blogs/steven/pivot/templates/X86CodeHighlighter0.1.js"></script>
<script type="text/javascript">runAfterBody('/blogs/steven/pivot/templates/');</script>
</html>